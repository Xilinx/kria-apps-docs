<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Introduction &mdash; Kria™ KR260 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../index.html" class="icon icon-home"> Kria™ KR260
            <img src="../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KR260 Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../10gige_vision_camera/10gige_vision_camera_landing.html">10GigE Vision Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ros2_multinode_communication_via_tsn/ros2_multinode_communication_via_tsn_landing.html">ROS 2 Multi-Node Communications via TSN</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.xilinx.com/products/app-store/kria/ros-2-perception-node.html">ROS 2 Perception Node</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KR260 Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../building_the_design.html">Building the Design components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_vivado_design.html">Building the Hardware design using Vivado</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build_vitis_platform.html">Creating a Vitis Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generating_custom_firmware.html">Generating Custom Firmware</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Kria™ KR260</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/ros2_perception_node/docs/app_deployment.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="../../media/xilinx-logo.png" width="30%"/><h1>Kria&trade; KR260 Robotics Starter Kit <br>TSN ROS Pub Sub Tutorial</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h1>Setting up the Board and Application Deployment</h1> </td>
 </tr>
</table><div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>This document shows, how to setup the board and environment to execute Perception stack application.</p>
<br></div>
<div class="section" id="hardware-requirement">
<h1>Hardware Requirement<a class="headerlink" href="#hardware-requirement" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>KR260 Robotics starter kit</p></li>
<li><p>Power supply and adaptor</p></li>
<li><p>Ethernet cable</p></li>
<li><p>Micro-USB to USB-A cable</p></li>
<li><p>A 16 GB MicroSD card</p></li>
<li><p>Ubuntu 20.04 workstation with ethernet port</p></li>
</ul>
<br></div>
<div class="section" id="environment-setup-on-host-machine">
<h1>Environment Setup On Host Machine<a class="headerlink" href="#environment-setup-on-host-machine" title="Permalink to this heading">¶</a></h1>
<ol class="simple">
<li><p>Install ROS2 using debian package, see install guide <a class="reference external" href="https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html">here</a>.</p></li>
<li><p>Install KRS 1.0, see installation steps <a class="reference external" href="https://xilinx.github.io/KRS/sphinx/build/html/docs/install.html#">here</a>.</p></li>
</ol>
<br></div>
<div class="section" id="setting-up-the-board">
<h1>Setting Up The Board<a class="headerlink" href="#setting-up-the-board" title="Permalink to this heading">¶</a></h1>
<p><em>TBD</em></p>
<br></div>
<div class="section" id="run-the-application">
<h1>Run The Application<a class="headerlink" href="#run-the-application" title="Permalink to this heading">¶</a></h1>
<p>This application has four flavours, which are developed in way that user can understand how he can tweek the application to achieve a desired performance during development. Below are versions and its details:</p>
<ol class="simple">
<li><p><strong>CPU Baseline</strong>
This is a very simplistic version, where nodes are not accelerated and are executed on CPU. This version should allow users get familier with working environment and understand easiness in working with KRS based applications. Use below steups to execute:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Launch Gazebo simulator in your workstation</span>
<span class="c1">#  requires Gazebo installed and GUI-capabilities</span>
$ <span class="nb">cd</span> ~/krs_ws  <span class="c1"># head to your KRS workspace</span>
$ <span class="nb">source</span> /opt/ros/rolling/setup.bash  <span class="c1"># Sources system ROS 2 installation</span>
$ colcon build --merge-install  <span class="c1"># build the workspace to deploy KRS components</span>
$ <span class="nb">source</span> install/setup.bash  <span class="c1"># source the workspace as an overlay</span>
$ ros2 launch perception_2nodes simulation.launch.py

<span class="c1"># Launch the graph in the KV260 CPU (should be connected to the same local network)</span>
$ <span class="nb">source</span> /opt/ros/rolling/setup.bash
$ ros2 launch perception_2nodes trace_rectify_resize.launch.py
</pre></div>
</div>
<p><img alt="../../../_images/perception_graph.gif" src="../../../_images/perception_graph.gif" /></p>
<ol class="simple">
<li><p>FPGA Accelerated: Here we introduce a custom compute architecture where hardware acceleration is achieved using FPGA. We first accelerate the computations at each one of the graph nodes. <code class="docutils literal notranslate"><span class="pre">/rectify_node_fpga</span></code> and <code class="docutils literal notranslate"><span class="pre">/resize/resize_node_fpga</span></code> <em>Components</em> of the use case above are accelerated using Xilinx’s HLS, XRT and OpenCL targeting the Kria KR260. The changes in the ROS 2 <em>Components</em> of <code class="docutils literal notranslate"><span class="pre">image_pipeline</span></code> to leverage hardware acceleration in the FPGA are available in <a class="reference external" href="https://github.com/ros-acceleration/image_pipeline/blob/ros2/image_proc/src/rectify_fpga.cpp"><code class="docutils literal notranslate"><span class="pre">rectify_fpga</span></code></a> and <a class="reference external" href="https://github.com/ros-acceleration/image_pipeline/blob/ros2/image_proc/src/resize_fpga.cpp"><code class="docutils literal notranslate"><span class="pre">resize_fpga</span></code></a> respectively. Each one of the ROS 2 <em>Components</em> has an associated acceleration kernel that leverages the Vitis Vision Library, a computer vision library optimized for Xilinx silicon solutions and based on OpenCV APIs. Source code of the acceleration kernels is available <a class="reference external" href="https://github.com/ros-acceleration/image_pipeline/tree/ros2/image_proc/src/image_proc">here</a>. To launch the perception graph with FPGA offloading using the Vitis Vision Library:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Launch the graph in the KV260 CPU (should be connected to the same local network as the workstation)</span>
$ <span class="nb">source</span> /opt/ros/rolling/setup.bash  <span class="c1"># enable ROS 2 overlays</span>
$ ros2 acceleration <span class="k">select</span> image_proc  <span class="c1"># select and load the accelerator</span>
$ ros2 launch perception_2nodes trace_rectify_resize_fpga.launch.py  <span class="c1"># launch Nodes</span>
</pre></div>
</div>
<p><img alt="../../../_images/perception_graph_fpga.gif" src="../../../_images/perception_graph_fpga.gif" /></p>
<br><ol class="simple">
<li><p>FPGA integrated acceleration: It is observed that during tracing and benchmarking (see how-to here <em>TBD</em>), there is scope of perforamance improvement by achieving efficient inter-process communication. It required to rearchitect the application and both ROS components (rectify and resize) were integrated to one. The benefits achieved are, first, it avoids ROS2 message passing between rectify and resize and second, it avoids compute cycles which were wasted in memory mapping back and forth data between CPU and FPGA. It achieved gain for over 26.96% (see benchmarking for more details). Steps to execute integrated application are:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># integrated</span>
$ <span class="nb">source</span> /opt/ros/rolling/setup.bash  <span class="c1"># enable ROS 2 overlays</span>
$ ros2 acceleration <span class="k">select</span> image_proc_integrated  <span class="c1"># select and load the accelerator</span>
$ ros2 launch perception_2nodes trace_rectify_resize_fpga_integrated.launch.py  <span class="c1"># launch Nodes</span>
</pre></div>
</div>
<p><img alt="../../../_images/perception_graph_integrated.gif" src="../../../_images/perception_graph_integrated.gif" /></p>
<br><ol class="simple">
<li><p>FPGA streamline accelerated: In this application ROS <em>Components</em> <code class="docutils literal notranslate"><span class="pre">RectifyNodeFPGAStreamlined</span></code> and <code class="docutils literal notranslate"><span class="pre">ResizeNodeFPGAStreamlined</span></code> are redesigned to leverage hardware acceleration, however, besides offloading perception tasks to the FPGA, each <ins>leverages an AXI4-Stream interface to <strong>create an intra-FPGA ROS 2 communication queue</strong> which is then used to pass data across nodes through the FPGA</ins>. This allows to avoid completely the ROS 2 message-passing system and optimizes dataflow achieving a <strong>24.42% total speedup</strong>. Steps to launch streamlined accelerated version are:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># integrated</span>
$ <span class="nb">source</span> /opt/ros/rolling/setup.bash  <span class="c1"># enable ROS 2 overlays</span>
$ ros2 acceleration <span class="k">select</span> image_proc_integrated  <span class="c1"># select and load the accelerator</span>
$ ros2 launch perception_2nodes trace_rectify_resize_fpga_integrated.launch.py  <span class="c1"># launch Nodes</span>
</pre></div>
</div>
<p><img alt="../../../_images/perception_graph_integrated.gif" src="../../../_images/perception_graph_integrated.gif" /></p>
<br><!---

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License.

You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.


Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.

--><p class="sphinxhide" align="center">Copyright&copy; 2022 Xilinx</p></div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on August 25, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>