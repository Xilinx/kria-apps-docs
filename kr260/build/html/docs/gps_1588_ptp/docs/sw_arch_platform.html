<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Software Architecture of the Platform &mdash; Kria™ KR260 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Hardware Architecture of the Platform" href="hw_arch_platform.html" />
    <link rel="prev" title="Board Setup and Application Deployment" href="app_deployment.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../index.html" class="icon icon-home"> Kria™ KR260
            <img src="../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/Kria_doc_map/map.htm">Kria Adventure Map</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ipmi_eeprom.html">IPMI EEPROM Design Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">KR260 Applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../10gige_vision_camera/10gige_vision_camera_landing.html">10GigE Vision Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ros2_multinode_communication_via_tsn/ros2_multinode_communication_via_tsn_landing.html">ROS 2 Multi-Node Communications via TSN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ros2_perception_node/ros2_perception_node_landing.html">ROS 2 Perception Node</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html">Precision Time Management</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html#tutorials">Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html#architecture">Architecture</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Software Architecture - Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gps-1588-ptp-application">GPS-1588-PTP Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hw_arch_platform.html">Hardware Architecture - Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html#xilinx-support">Xilinx Support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bist/bist_landing.html">Built-In Self Test (BIST)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Kria™ KR260</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../gps_1588_ptp_precision_time_mgmt.html">Precision time Management</a> &raquo;</li>
      <li>Software Architecture of the Platform</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/gps_1588_ptp/docs/sw_arch_platform.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="software-architecture-of-the-platform">
<h1>Software Architecture of the Platform<a class="headerlink" href="#software-architecture-of-the-platform" title="Permalink to this heading">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>This section describes software components involved in the design and their relation with each other. The application requires hw platform as described in <a class="reference internal" href="hw_arch_platform.html"><span class="doc">Hardware Architecture of the Platform</span></a> for the stack explained in this section to work.</p>
<p>Following diagram illustrate top level architecture and arrangement of various software components</p>
<p><img alt="Software Architecture Overview" src="../../../_images/sw_arch_intro.png" /></p>
<ul>
<li><p>Operating System: Xilinx Linux kernel + Ubuntu env</p>
<ul class="simple">
<li><p>Drivers:</p>
<ul>
<li><p>Uart lite</p></li>
<li><p>PPS-GPIO</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Applications</p>
<ul class="simple">
<li><p>gpsd</p></li>
<li><p>chrony</p></li>
<li><p>Linux ptp utilities for clock sync</p></li>
<li><p>pps-tools</p></li>
</ul>
<p>The details of each individual component can be obtained though the reference at the end of this section. The scope of this document is with respect to what is being demonstrated through the example application.</p>
</li>
</ul>
<div class="section" id="gpsd">
<h3>Gpsd<a class="headerlink" href="#gpsd" title="Permalink to this heading">¶</a></h3>
<p>Gpsd is a service Daemon for establishing the connection to the external GPS Receiver,This Daemon is configured to read and process UBX protocol messages through the Uart interface on the master node.The results are provided via an IPC shared memory buffer.</p>
</div>
<div class="section" id="chrony">
<h3>Chrony<a class="headerlink" href="#chrony" title="Permalink to this heading">¶</a></h3>
<p>Chrony is a daemon for synchronization of the system clock. It can synchronize the clock with NTP servers, reference clocks (e.g. a GPS receiver),it is configured to work with shared memory segment and also process the PPS (/dev/ppsX) interface.</p>
</div>
<div class="section" id="linux-ptp-utilities">
<h3>Linux ptp utilities:<a class="headerlink" href="#linux-ptp-utilities" title="Permalink to this heading">¶</a></h3>
<div class="section" id="phc2sys">
<h4>Phc2sys<a class="headerlink" href="#phc2sys" title="Permalink to this heading">¶</a></h4>
<p>phc2sys establishes the synchronization between the PHC and system clocks ,the actual synchronization direction depends on the role of the node.</p>
</div>
</div>
<div class="section" id="ptp4l">
<h3>ptp4l<a class="headerlink" href="#ptp4l" title="Permalink to this heading">¶</a></h3>
<p>ptp4l implements the PTP network protocol and aligns the PHC clocks on the both master and slave.</p>
</div>
<div class="section" id="pps-tools">
<h3>pps-tools<a class="headerlink" href="#pps-tools" title="Permalink to this heading">¶</a></h3>
<p>It is a tool to monitor PPS timestamps from pps device.</p>
</div>
</div>
<div class="section" id="gps-1588-ptp-application">
<h2>GPS-1588-PTP Application<a class="headerlink" href="#gps-1588-ptp-application" title="Permalink to this heading">¶</a></h2>
<p>By using this application,system time of the embedded platform is synchronized with gps time using ubuntu daemons and linux-ptp utilities. The system time of the master side is distributed to the connected slaves in the network.</p>
<div class="section" id="how-synchronization-works">
<h3>How Synchronization works<a class="headerlink" href="#how-synchronization-works" title="Permalink to this heading">¶</a></h3>
<p>The synchronization starts by synchronizing the system time of the Master KR260 board w.r.t GPS time using the Network Time Protocol (NTP) daemon chrony. In our case, we have configured two sources from GPS receiver.</p>
<ol class="simple">
<li><p>GPS receiver UART interface as a source of GPS time via AXI Uart lite driver.</p></li>
<li><p>GPS Receiver PPS input as PPS source registered as pps-gpio driver to correct the system time
w. r.t the high precision PPS pulse.</p></li>
</ol>
<p>Using the Linux PTP tools phc2sys the Master side GEM TSU timer is aligned w.r.t the system time.
In the slave side, ptp4l first synchronize the GEM PHC with the mater side PHC using PTP packets via the GEM PS ethernet interface. followed by that, the slave board system clock is synchronized to PHC clock using the phc2sys tool. Now the synchronization direction is from PHC clock to system clock.</p>
</div>
<div class="section" id="linux-driver">
<h3>Linux driver<a class="headerlink" href="#linux-driver" title="Permalink to this heading">¶</a></h3>
<div class="section" id="uart-lite">
<h4>Uart lite<a class="headerlink" href="#uart-lite" title="Permalink to this heading">¶</a></h4>
<p>This component contains the implementation of the Uart Lite component which is the driver for the Xilinx UART Lite device. This UART is a minimal hardware implementation with minimal features. Most of the features, including baud rate, parity, and number of data bits are only configurable when the hardware device is built, rather than at run time by software.
This driver requires different compatibility string and hence the original device tree node’s compatible string needs to be overwritten as below</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&amp;axi_uartlite_0 {
      compatible = &quot;xlnx,axi-uartlite-2.0&quot;,&quot;xlnx,xps-uartlite-1.00.a&quot;;
};
</pre></div>
</div>
</div>
<div class="section" id="pps-gpio">
<h4>PPS-GPIO<a class="headerlink" href="#pps-gpio" title="Permalink to this heading">¶</a></h4>
<p>This driver is derived from the current parallel port PPS generator and provides a PPS signal through a GPIO pin specified in the device tree. PPS means “pulse per second” and a PPS source is just a device which provides a high precision signal each second so that an application can use it to adjust system clock time.<br />For details of the device tree for the driver can be found in the kernel documentation at <a class="reference external" href="https://github.com/Xilinx/linux-xlnx/blob/master/Documentation/devicetree/bindings/pps/pps-gpio.txt">linux-xlnx</a></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  	pps_axi_gpio_0 {
              pinctrl-names = &quot;default&quot;;
              gpios = &lt;&amp;gpio 78 0 0 &gt;;
              compatible = &quot;pps-gpio&quot;;
              };
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842249/Uartlite+Driver">Xilinx Uart lite Driver</a></p></li>
<li><p><a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18841740/Macb+Driver">macb driver</a></p></li>
<li><p><a class="reference external" href="https://gpsd.io/">gpsd</a></p></li>
<li><p><a class="reference external" href="https://chrony.tuxfamily.org/index.html">chrony</a></p></li>
<li><p><a class="reference external" href="https://linuxptp.nwtime.org/documentation/">linuxptp</a></p></li>
</ul>
<div class="section" id="next-steps">
<h3>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="app_deployment.html"><span class="doc">Application Deployment</span></a></p></li>
<li><p><a class="reference internal" href="hw_arch_platform.html"><span class="doc">Hardware Architecture of the Platform</span></a></p></li>
<li><p>Go back to the <a class="reference internal" href="../gps_1588_ptp_precision_time_mgmt.html"><span class="doc">KR260 SOM GPS-1588-PTP App Start Page</span></a></p></li>
</ul>
<!---

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License.

You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.

--><p class="sphinxhide" align="center">Copyright (C) 2023 Advanced Micro Devices, Inc.</p></div>
</div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="app_deployment.html" class="btn btn-neutral float-left" title="Board Setup and Application Deployment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hw_arch_platform.html" class="btn btn-neutral float-right" title="Hardware Architecture of the Platform" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on March 06, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>