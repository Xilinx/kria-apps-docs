<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Xen Kria SOM Starter Kits Support &mdash; XEN Kria SOM Support 2022.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="XEN Kria Support" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> XEN Kria SOM Support
            <img src="../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/Kria_doc_map/map.htm">Kria Adventure Map</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/freertos.html">FreeRTOS Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">XEN Kria Support</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Xen Kria SOM Starter Kits Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-xen-artifacts">Generating Xen Artifacts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-xen-artifacts-in-native-yocto-tool-flow">Generating Xen Artifacts in Native Yocto Tool Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xen-artifacts-in-petalinux-tool-flow">Xen Artifacts in PetaLinux tool flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-sd-card">Prepare SD Card</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#partition-1">Partition 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partition-2">Partition 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partition-3">Partition 3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#boot-xen-on-target">Boot XEN On Target</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#boot-ubuntu-as-domu">Boot UBuntu as DOMU</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#kria-starter-kit-embedded-linux-as-domu">Kria Starter Kit Embedded Linux as DOMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="#known-limitations">Known Limitations</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">XEN Kria SOM Support</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Xen Kria SOM Starter Kits Support</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/xen_kria_support.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="xen-kria-som-starter-kits-support">
<h1>Xen Kria SOM Starter Kits Support<a class="headerlink" href="#xen-kria-som-starter-kits-support" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://xenproject.org/">Xen</a> is a free and open-source hypervisor, providing services that allow multiple computer operating systems to execute on the same computer hardware concurrently. The 2023.2 Kria Starter Kit Petalinux BSP  as well as Yocto contains support for XEN. AMD specific details about XEN hypervisor can be found on its <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842530/XEN+Hypervisor">wiki page</a>.</p>
<p>This page documents how to generate XEN artifacts (based on Kria Starter Kit embedded Linux) for Kria and gives an example on how to boot Ubuntu as guest OS (aka, a DOMU) on a XEN DOM0. This particular combination requires about 4GB of memory, which K26 has. Therefore this can be done on either KV260 or KR260. K24 only has 2 GB of memory, therefore it does not support Xen.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<ol class="simple">
<li><p>Experience and equipments booting a regular Kria Starter Kit embedded Linux on Kria SOM Starter Kit (you can follow <a class="reference external" href="https://www.xilinx.com/products/som/kria/kv260-vision-starter-kit/kv260-getting-started/setting-up-the-sd-card-image.html">getting started with PetaLinux on KV260</a>, but use a wic image from 2023.2 BSP for your Starter Kit on a minimum 16GB SD Card)</p></li>
<li><p>A Linux Desktop to create and program partitions</p></li>
<li><p>Yocto (preferred) or PetaLinux tool</p></li>
</ol>
</div>
<div class="section" id="generating-xen-artifacts">
<h2>Generating Xen Artifacts<a class="headerlink" href="#generating-xen-artifacts" title="Permalink to this heading">¶</a></h2>
<p>Xen artifacts can be generated by native Yocto tool flow or found in PetaLinux BSP. You can choose to use one of the tools to create Xen artifacts.</p>
<div class="section" id="generating-xen-artifacts-in-native-yocto-tool-flow">
<h3>Generating Xen Artifacts in Native Yocto Tool Flow<a class="headerlink" href="#generating-xen-artifacts-in-native-yocto-tool-flow" title="Permalink to this heading">¶</a></h3>
<p>First, set up a Yocto project on a host with Yocto support using the instructions <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto/build/html/docs/yocto_kria_support.html">here</a>, stop after <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">setupsdk</span></code> step.</p>
<p>Then append the following to the end of <code class="docutils literal notranslate"><span class="pre">build/conf/local.conf</span></code> to enable Xen:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">BOOTMODE</span> <span class="o">=</span> <span class="s2">&quot;xen&quot;</span>
IMAGE_INSTALL:append <span class="o">=</span> <span class="s2">&quot;packagegroup-petalinux-xen&quot;</span>
<span class="nv">ENABLE_XEN_DTSI</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="nv">ENABLE_XEN_QEMU_DTSI</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="nv">ENABLE_XEN_UBOOT_SCR</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="nv">XEN_SERIAL_CONSOLES</span> <span class="o">=</span> <span class="s2">&quot;serial1&quot;</span>
</pre></div>
</div>
<p>Then build the image the usual way:</p>
<p>To generate Xen support for KV260, use k26-smk-kv as the <code class="docutils literal notranslate"><span class="pre">&lt;machine</span> <span class="pre">name&gt;</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">MACHINE</span><span class="o">=</span>k26-smk-kv bitbake kria-image-full-cmdline
</pre></div>
</div>
<p>To generate Xen support for KR260, use k26-smk-kr as the <code class="docutils literal notranslate"><span class="pre">&lt;machine</span> <span class="pre">name&gt;</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">MACHINE</span><span class="o">=</span>k26-smk-kr bitbake kria-image-full-cmdline
</pre></div>
</div>
<p>There is no Xen support for combined MACHINE name <code class="docutils literal notranslate"><span class="pre">k26-smk</span></code>.</p>
<p>Yocto generated wic that contains XENs support can be found in <code class="docutils literal notranslate"><span class="pre">&lt;yocto_project&gt;/build/tmp/deploy/images/&lt;machine</span> <span class="pre">name&gt;/kria-image-full-cmdline-&lt;machine</span> <span class="pre">name&gt;.wic</span></code> in the Yocto project.</p>
</div>
<div class="section" id="xen-artifacts-in-petalinux-tool-flow">
<h3>Xen Artifacts in PetaLinux tool flow<a class="headerlink" href="#xen-artifacts-in-petalinux-tool-flow" title="Permalink to this heading">¶</a></h3>
<p>Users are encouraged to use Yocto flow, as it is verified and steps are simpler in <a class="reference external" href="#prepare-sd-card">Prepare SD card</a> stage. If user still require to use PetaLinux, download a 2023.2 or later <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#PetaLinux-Board-Support-Packages">Kria SOM Starter Kit BSP</a>. Extract the PetaLinux project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-&lt;hardware&gt;-&lt;version&gt;-&lt;timestamp&gt;.bsp
<span class="nb">cd</span> xilinx-&lt;hardware&gt;-&lt;version&gt;
</pre></div>
</div>
<p>The wic image required is in <code class="docutils literal notranslate"><span class="pre">pre-built/linux/images/petalinux-sdimage.wic.xz</span></code>, and the XEN artifacts required can be found in <code class="docutils literal notranslate"><span class="pre">pre-built/linux/xen</span></code>.</p>
</div>
</div>
<div class="section" id="prepare-sd-card">
<h2>Prepare SD Card<a class="headerlink" href="#prepare-sd-card" title="Permalink to this heading">¶</a></h2>
<p>Flash the embedded Linux wic image from either <a class="reference external" href="#generating-xen-artifacts-in-native-yocto-tool-flow">Yocto</a> or <a class="reference external" href="#xen-artifacts-in-petalinux-tool-flow">PetaLinux flow</a> to an SD card using Balena Etcher. This will set up the SD card to contain 2 partitions - partition 1 with boot images (accessible by Windows and Linux) that we will discard and partition 2 with Kria Starter Kit embedded Linux rootfs (not accessible by Windows) that will also be used for XEN DOM0.</p>
<div class="section" id="partition-1">
<h3>Partition 1<a class="headerlink" href="#partition-1" title="Permalink to this heading">¶</a></h3>
<p>If you are using Yocto generated wic image - partition 1 already contain XEN artifacts as the wic is generated with XEN support. Below step is for PetaLinux tool Flow only.</p>
<p>PetaLinux tool flow only: Open the SD card on a host computer (can be Windows or Linux), go to partition 1, remove the boot images on that partition and copy all the XEN artifacts in <code class="docutils literal notranslate"><span class="pre">pre-built/linux/xen</span></code> into partition 1.</p>
<p>We then need to copy over the Ubuntu image that we want to boot as DOMU. Download the <a class="reference external" href="https://people.canonical.com/~platform/images/xilinx/kria-ubuntu-22.04/iot-limerick-kria-classic-desktop-2204-x07-20230302-63-system-boot.tar.gz?_ga=2.93916574.2043050383.1684286640-1062417632.1681766747">iot-limerick-kria-classic-desktop-2204-x07-20230302-63-system-boot.tar.gz</a> file from <a class="reference external" href="https://ubuntu.com/download/amd-xilinx">Kria Ubuntu download site</a>, un-compress it, and copy <code class="docutils literal notranslate"><span class="pre">image.fit</span></code> file into partition 1 for DOMU later. This file is not being used in XEN booting, but we use SD partition 1 as a place to transfer the file onto target.</p>
</div>
<div class="section" id="partition-2">
<h3>Partition 2<a class="headerlink" href="#partition-2" title="Permalink to this heading">¶</a></h3>
<p>Partition 2 was programmed with a Kria Starter Kit embedded Linux rootfs from setting SD card image with the Kria Starter Kit embedded Linux .wic image. This can be re-used for XEN.</p>
</div>
<div class="section" id="partition-3">
<h3>Partition 3<a class="headerlink" href="#partition-3" title="Permalink to this heading">¶</a></h3>
<p>This step needs to be done a Linux host.</p>
<p>Download the Ubuntu rootfs for DomU. Ubuntu image can be downloaded from <a class="reference external" href="https://ubuntu.com/download/amd-xilinx">Kria Ubuntu download site</a>. For this example, we will be using <a class="reference external" href="https://people.canonical.com/~platform/images/xilinx/kria-ubuntu-22.04/iot-limerick-kria-classic-desktop-2204-x07-20230302-63-rootfs.ext4.xz?_ga=2.22151480.2043050383.1684286640-1062417632.1681766747">iot-limerick-kria-classic-desktop-2204-x07-20230302-63-rootfs.ext4.xz</a> file.</p>
<p>Unzip the downloaded rootfs file to .ext4 using following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xz -d iot-limerick-kria-classic-desktop-2204-x07-20230302-63-rootfs.ext4.xz
</pre></div>
</div>
<p>Plug the SD card into a Linux host machine, in this example we assume the sd card is found in <code class="docutils literal notranslate"><span class="pre">/dev/sda</span></code> but you may find it in different file path dependent on your machine. Observe the 2 partitions with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">fdisk</span> <span class="pre">-l</span> <span class="pre">/dev/sda</span></code>, it should look like the following with two partitions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Device     Boot   Start      End Sectors Size Id Type
/dev/sda1  *          <span class="m">8</span>  <span class="m">4194311</span> <span class="m">4194304</span>   2G  c W95 FAT32 <span class="o">(</span>LBA<span class="o">)</span>
/dev/sda2       <span class="m">4194312</span> <span class="m">12582919</span> <span class="m">8388608</span>   4G <span class="m">83</span> Linux
</pre></div>
</div>
<p>Enter command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">fdisk</span> <span class="pre">/dev/sda</span></code>, Enter <code class="docutils literal notranslate"><span class="pre">n</span></code> to create a new partition. It will ask about partition type, enter <code class="docutils literal notranslate"><span class="pre">p</span></code>, next it will ask about Partition number, please hit enter or enter the number <code class="docutils literal notranslate"><span class="pre">3</span></code>. Finally, it will ask for First and Last Sector - hit enter to automatically create partition with all remaining storage on sd card.</p>
<p>Now it should look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
Partition <span class="nb">type</span>
p primary <span class="o">(</span><span class="m">2</span> primary, <span class="m">0</span> extended, <span class="m">2</span> free<span class="o">)</span>
e extended <span class="o">(</span>container <span class="k">for</span> logical partitions<span class="o">)</span>
Select <span class="o">(</span>default p<span class="o">)</span>: p
Partition number <span class="o">(</span><span class="m">3</span>,4, default <span class="m">3</span><span class="o">)</span>: <span class="m">3</span>
 
First sector <span class="o">(</span><span class="m">12582920</span>-31116287, default <span class="m">12584960</span><span class="o">)</span>:
Last sector, +sectors or +size<span class="o">{</span>K,M,G,T,P<span class="o">}</span> <span class="o">(</span><span class="m">12584960</span>-31116287, default <span class="m">31116287</span><span class="o">)</span>:
 
Created a new partition <span class="m">3</span> of <span class="nb">type</span> <span class="s1">&#39;Linux&#39;</span> and of size <span class="m">8</span>.9 GiB.
</pre></div>
</div>
<p>Next, enter <code class="docutils literal notranslate"><span class="pre">w</span></code> to write the partition table and exit.</p>
<p>Next, format the newly created partition to support ext4 rootfs. Use following command to format it to a .ext4 format:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkfs.ext4 -L root /dev/sda3
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/dev/sda3</span></code> is the path for new partition that we will use for rootfs for DOMU. Run “sudo fdisk -l” again to verify all the partition. It should look similar to what is shown below with 3 partitions:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Device     Boot    Start      End  Sectors  Size Id Type
/dev/sda1  *           8  4194311  4194304    2G  c W95 FAT32 (LBA)
/dev/sda2        4194312 12582919  8388608    4G 83 Linux
/dev/sda3       12584960 31116287 18531328  8.9G 83 Linux
</pre></div>
</div>
<p>lastly,  copy Ubuntu rootfs that we download and extracted earlier to partition <code class="docutils literal notranslate"><span class="pre">/dev/sda3</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo dd <span class="k">if</span><span class="o">=</span>iot-limerick-kria-classic-desktop-2204-x07-20230302-63-rootfs.ext4  <span class="nv">of</span><span class="o">=</span>/dev/sda3
</pre></div>
</div>
<p>Quick tip: if dd gives error that “No space left on device” yet the file is smaller than space allocated, do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo rm /dev/sda3
sudo fdisk /dev/sda <span class="c1"># enter &quot;D&quot; and then &quot;3&quot; to delete partition 3</span>
<span class="c1">#then remove the SD card and reinsert and go back to the beginning of this section to start from creating partition 3 again.</span>
</pre></div>
</div>
<p>Now partition 3 is ready as well.</p>
</div>
</div>
<div class="section" id="boot-xen-on-target">
<h2>Boot XEN On Target<a class="headerlink" href="#boot-xen-on-target" title="Permalink to this heading">¶</a></h2>
<p>Plug the SD card into Starter Kit and turn on the power. If you used Yocto to generate the Xen artifact - it will automatically boot Xen- you can move to the next section.</p>
<p>If you used PetaLinux to generate Xen artifacts, you should automatically get to u-boot command prompt. Enter this to load xen_boot_sd.scr to 0xc00000 and source the script to boot xen:</p>
<p>For KV260, SD card is on mmc, therefore use the following commands to boot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>load mmc <span class="m">1</span>:1 0xc00000 xen_boot_sd.scr <span class="c1">#KV260 only!</span>
<span class="nb">source</span> 0xc00000
</pre></div>
</div>
<p>for KR260, SD Card is on USB, therefore use the following commands to boot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>load usb <span class="m">0</span> 0xc00000 xen_boot_sd.scr <span class="c1">#KR260 only!</span>
<span class="nb">source</span> 0xc00000
</pre></div>
</div>
<p>This will boot Kria Starter Kit embedded Linux XEN aka DOM0.</p>
<div class="section" id="boot-ubuntu-as-domu">
<h3>Boot UBuntu as DOMU<a class="headerlink" href="#boot-ubuntu-as-domu" title="Permalink to this heading">¶</a></h3>
<p>First, change to root:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -s
</pre></div>
</div>
<p>Locate <code class="docutils literal notranslate"><span class="pre">image.fit</span></code> file in <code class="docutils literal notranslate"><span class="pre">/boot/image.fit</span></code>, but location may vary dependent on release and tool used. One can search for it using <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">/</span> <span class="pre">-iname</span> <span class="pre">&quot;image.fit&quot;</span></code>.</p>
<p>extract the Ubuntu kernel image:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dumpimage -T flat_dt -p <span class="m">0</span> /boot/image.fit -o /home/petalinux/ubuntu_Image <span class="c1"># for KV260</span>
dumpimage -T flat_dt -p <span class="m">0</span> /boot/image.fit -o /home/petalinux/ubuntu_Image <span class="c1"># for KR260</span>
</pre></div>
</div>
<p>Next, check how much memory is dom0 consuming and available memory using <code class="docutils literal notranslate"><span class="pre">xl</span> <span class="pre">info</span></code>. In our example we should have a little more than 1.9G left to use for DOMU and therefore we will allocate 1900MB for DOMU in next step.</p>
<p>Create a <code class="docutils literal notranslate"><span class="pre">guest0.cfg</span></code> file with the following content:</p>
<p>If running Xen on KV260:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;guest0&quot;</span>
<span class="nv">kernel</span> <span class="o">=</span> <span class="s2">&quot;/home/petalinux/ubuntu_Image&quot;</span> <span class="c1"># Ubuntu Kernel extracted</span>
<span class="nv">disk</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;/dev/mmcblk1p3,,xvda&#39;</span><span class="o">]</span> <span class="c1"># Ubuntu Rootfs in partition 3</span>
<span class="nv">extra</span> <span class="o">=</span> <span class="s2">&quot;console=hvc0 root=/dev/xvda&quot;</span>
<span class="nv">memory</span> <span class="o">=</span> <span class="m">1900</span> <span class="c1"># This can be increased if there is more free memory.</span>
<span class="nv">vcpus</span> <span class="o">=</span> <span class="m">2</span>
</pre></div>
</div>
<p>If running Xen on KR260:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;guest0&quot;</span>
<span class="nv">kernel</span> <span class="o">=</span> <span class="s2">&quot;/home/petalinux/ubuntu_Image&quot;</span> <span class="c1"># Ubuntu Kernel extracted</span>
<span class="nv">disk</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;/dev/sda3,,xvda&#39;</span><span class="o">]</span> <span class="c1"># Ubuntu Rootfs in partition 3</span>
<span class="nv">extra</span> <span class="o">=</span> <span class="s2">&quot;console=hvc0 root=/dev/xvda&quot;</span>
<span class="nv">memory</span> <span class="o">=</span> <span class="m">1900</span> <span class="c1"># This can be increased if there is more free memory.</span>
<span class="nv">vcpus</span> <span class="o">=</span> <span class="m">2</span>
</pre></div>
</div>
<p>Next, check if /dev/mmcblk1p3 or /dev/sda3 is mounted automatically by dom0 using <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">-h</span></code>, if its mounted, unmount it so that DOMU can use it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>umount /dev/mmcblk1p3 <span class="c1"># KV260 only</span>
umount /dev/sda3 <span class="c1"># KR260 only</span>
</pre></div>
</div>
<p>Start guest0/DOMU using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xl create -c guest0.cfg
</pre></div>
</div>
<p>This will boot to <code class="docutils literal notranslate"><span class="pre">root&#64;ubuntu</span></code>.</p>
<p>To get out of DOMU, press <code class="docutils literal notranslate"><span class="pre">ctrl-]</span></code>.</p>
<p>After getting out of DOMU, in XEN DOM0 prompt, Enter <code class="docutils literal notranslate"><span class="pre">xl</span> <span class="pre">list</span></code> to see a list of OSes running, you should see something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xilinx-kv260-starterkit-20231:/home/petalinux# xl list
Name                                        ID   Mem VCPUs      State   Time<span class="o">(</span>s<span class="o">)</span>
Domain-0                                     <span class="m">0</span>  <span class="m">2048</span>     <span class="m">1</span>     r-----   <span class="m">17916</span>.8
guest0                                       <span class="m">1</span>  <span class="m">1899</span>     <span class="m">2</span>     r-----   <span class="m">28894</span>.7
</pre></div>
</div>
<p>To access the guest0 DOMU again, do <code class="docutils literal notranslate"><span class="pre">xl</span> <span class="pre">console</span> <span class="pre">&lt;ID&gt;</span></code></p>
<p>To kill the guest0 DOMU, identify the <ID> from the prints, and then execute <code class="docutils literal notranslate"><span class="pre">xl</span> <span class="pre">destroy</span> <span class="pre">&lt;ID&gt;</span></code> to kill the session.</p>
<p>Another DOMU session can be started without having to re-boot XEN.</p>
</div>
</div>
<div class="section" id="kria-starter-kit-embedded-linux-as-domu">
<h2>Kria Starter Kit Embedded Linux as DOMU<a class="headerlink" href="#kria-starter-kit-embedded-linux-as-domu" title="Permalink to this heading">¶</a></h2>
<p>If you would like to run Kria Starter Kit embedded Linux instead of Ubuntu as DOMU, the steps are similar to that of Ubuntu OS as DOMU except for kernel image and root fs artifacts for the perspective OS, as well as the config file. The only 2 artifacts required in this example is in the image folder, file <code class="docutils literal notranslate"><span class="pre">Image</span></code> and file <code class="docutils literal notranslate"><span class="pre">rootfs.cpio.gz</span></code>, copy them into boot partition 1. For partition 3, skip the dd command and leave the partition empty.</p>
<p>Once booted up and in root, copy the two artifacts to partition 3. To find out where the partitions are mapped to, use command <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">-h</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>k26-smk-kv:~$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root       1.5G  955M  408M  71% /
devtmpfs        563M  4.0K  563M   1% /dev
tmpfs           693M     0  693M   0% /dev/shm
tmpfs           277M   11M  267M   4% /run
tmpfs           4.0M     0  4.0M   0% /sys/fs/cgroup
tmpfs           693M  4.0K  693M   1% /tmp
tmpfs           693M  136K  692M   1% /var/volatile
/dev/mmcblk1p1  511M  147M  365M  29% /boot
/dev/mmcblk1p3  113G  5.2G  103G   5% /run/media/writable-mmcblk1p3
tmpfs           139M     0  139M   0% /run/user/1000
</pre></div>
</div>
<p>In the example output above (for KV260), boot partition (mmcblk1p1) is mapped to <code class="docutils literal notranslate"><span class="pre">/boot</span></code>, and third partition (mmcblk1p3) is mounted to <code class="docutils literal notranslate"><span class="pre">/run/media/writable-mmcblk1p3</span></code></p>
<p>In this case, this would be the command to copy:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp /boot/Image /run/media/writable-mmcblk1p3
cp /boot/rootfs.cpio.gz /run/media/writable-mmcblk1p3
</pre></div>
</div>
<p>Use the following as guest0.cfg (adjusting kernel and ramdisk path accordingly):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>name = &quot;guest0&quot;
kernel = &quot;/run/media/writable-mmcblk1p3/Image&quot;
ramdisk = &quot;/run/media/writable-mmcblk1p3/rootfs.cpio.gz&quot;
extra =&quot;console=hvc0 init=/bin/sh root=/dev/ram0&quot;
memory = 1801
vcpus = 1
</pre></div>
</div>
</div>
<div class="section" id="known-limitations">
<h2>Known Limitations<a class="headerlink" href="#known-limitations" title="Permalink to this heading">¶</a></h2>
<ol class="simple">
<li><p>With current XEN hypervisor configuration, DOMU does not have access to peripherals. Peripheral access are mapped to dom0. Therefore, you will see that ethernet is not accessible for DOMU. Upon DOMU initialization (tested with Kria Starter Kit embedded Linux 2023.2 XEN + Ubuntu 22.04 x07 image) you will see cloud init errors.</p></li>
<li><p>XEN on Kria currently do not save its state across reboot - e.g. the files in rootfs or password will not persist over power cycles or reboots.</p></li>
</ol>
<p class="sphinxhide" align="center">Copyright&copy; 2023 Advanced Micro Devices, Inc</p></div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="XEN Kria Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on March 26, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>