<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>FreeRTOS Kria SOM Starter Kits Support &mdash; FreeRTOS Kria SOM Starter Kits Support  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FreeRTOS Kria SOM Starter Kits lwIP TCP Performance Server" href="freertos_kria_lwip_tcpperfserver.html" />
    <link rel="prev" title="FreeRTOS Kria SOM Starter Kits Support" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> FreeRTOS Kria SOM Starter Kits Support
            <img src="../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/Kria_doc_map/map.htm">Kria Adventure Map</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/freertos.html">FreeRTOS Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FreeRTOS Support</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">FreeRTOS Kria SOM Starter Kits Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#obtain-or-generate-xsa-file">Obtain or Generate .xsa file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-freertos-platform-application-in-vitis">Create FreeRTOS platform Application in Vitis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boot-freertos-on-platform">Boot FreeRTOS on platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#boot-freertos-vis-jtag">Boot FreeRTOS vis JTAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="#boot-freertos-using-qspi-in-a-b-update">Boot FreeRTOS Using QSPI in A/B update</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#next-step">Next Step</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="freertos_kria_lwip_tcpperfserver.html">FreeRTOS Kria SOM Starter Kits lwIP TCP Performance Server</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FreeRTOS Kria SOM Starter Kits Support</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>FreeRTOS Kria SOM Starter Kits Support</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/freertos_kria.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="freertos-kria-som-starter-kits-support">
<h1>FreeRTOS Kria SOM Starter Kits Support<a class="headerlink" href="#freertos-kria-som-starter-kits-support" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842141/FreeRTOS">FreeRTOS</a> is a real-time operating system (RTOS) kernel designed for embedded systems. It provides scheduling, multitasking, and various other services for applications running on microcontrollers and small microprocessors. FreeRTOS is open-source, allowing developers to use, modify, and distribute it freely under the MIT license.</p>
<p>Booting FreeRTOS on Kria Starter Kits mirrors the process on a standard ZynqMPSoC platform. This document offers a detailed, step-by-step procedure for running FreeRTOS on a Kria SOM APU processor.</p>
<p>To boot FreeRTOS, the initial step involves acquiring or generating a .xsa file. Next, the .xsa file is imported into Vitis to establish a FreeRTOS platform and application, and to create artifacts required to boot on target. Finally, various methods for booting FreeRTOS on Kria SOM are outlined.</p>
<p>In this tutorial, we employ the KV260 as a demonstration and utilized tool version 2023.2.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<ol class="simple">
<li><p>Vitis Installation</p></li>
<li><p>(Optional) Vivado installation</p></li>
</ol>
<div class="section" id="obtain-or-generate-xsa-file">
<h3>Obtain or Generate .xsa file<a class="headerlink" href="#obtain-or-generate-xsa-file" title="Permalink to this heading">¶</a></h3>
<p>A .xsa file corresponding to target Kria Starter Kit can be found in <a class="reference external" href="https://petalinux.xilinx.com/sswreleases">petalinux.xilinc.com</a> in <code class="docutils literal notranslate"><span class="pre">hdf-examples/</span></code> folder, or from PetaLinux BSP’s hardware/ folder. These are base .xsa file containing support for various PS peripherals, and has minimal PL contents.</p>
<p>Alternatively, you can generate a .xsa file by utilizing board files as outlined in the tutorial provided <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications/2022.1/build/html/docs/Generate_vivado_project_from_boardfile.html">here</a>.</p>
</div>
<div class="section" id="create-freertos-platform-application-in-vitis">
<h3>Create FreeRTOS platform Application in Vitis<a class="headerlink" href="#create-freertos-platform-application-in-vitis" title="Permalink to this heading">¶</a></h3>
<p>Please note that this tutorial is crafted using the 2023.2 version of Vitis, featuring the newly introduced interface GUI.</p>
<p>In Vitis welcome page, select “Create Platform Component” under “Embedded Development”</p>
<p><img alt="image" src="../_images/freertos_vitis1.PNG" /></p>
<p>Follow the prompt to enter Vitis Workspace location and platform component name. In this case we used <code class="docutils literal notranslate"><span class="pre">freertos_platform</span></code> as platform name.</p>
<p><img alt="image" src="../_images/freertos_vitis2.PNG" /></p>
<p>Select the .xsa generated in <a class="reference external" href="#generate-xsa-file-using-vivado-and-board-file">previous step</a>.</p>
<p>Select “freertos” as OS, and “psu_cortex53_0” as Processor. Also make sure to select “Generate Boot artifacts” and “Generate PMU Firmware”:</p>
<p><img alt="image" src="../_images/freertos_vitis3.PNG" /></p>
<p>Click through “next” and “finish”, and Vitis will create a freertos platform project (it may take a few minutes). In the created project, in “FLOW” tab, click “Build” to build the platform:</p>
<p><img alt="image" src="../_images/freertos_vitis4.PNG" /></p>
<p>Now navigate to example applications with the icons on the left, select “Embedded Software Examples” -&gt; “FREERTOS Hello World” and click on  “Create Application Component from Template”:</p>
<p><img alt="image" src="../_images/freertos_vitis5.PNG" /></p>
<p>Select Component name and location, in our case we used <code class="docutils literal notranslate"><span class="pre">freertos_hello_world</span></code> as component name. Then select the <code class="docutils literal notranslate"><span class="pre">freertos_platform</span></code> that we created:</p>
<p><img alt="image" src="../_images/freertos_vitis6.PNG" /></p>
<p>Click through next and finish. Now Vitis will generate an application component. In “FLOW” tab, select the application in “Component” pull down menu, and select “Build”</p>
<p><img alt="image" src="../_images/freertos_vitis7.PNG" /></p>
<p>You can find the generated artifacts in <code class="docutils literal notranslate"><span class="pre">&lt;vitis</span> <span class="pre">workspace&gt;/freertos_hello_world/build/freertos_hello_world.elf</span></code>,  <code class="docutils literal notranslate"><span class="pre">&lt;vitis</span> <span class="pre">workspace&gt;/freertos_platform/zynqmp_fsbl/build/fsbl.elf</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;vitis</span> <span class="pre">workspace&gt;freertos_platform/zynqmp_pmufw/build/pmufw.elf</span></code></p>
<p>Lastly, for QSPI booting options in later sections, click on “Create Boot Image”:
<img alt="image" src="../_images/freertos_vitis8.PNG" /></p>
<p>In the window that pops up, leave everything on default and click “Create Image”, you will find the generated artifact in <code class="docutils literal notranslate"><span class="pre">freertos_hello_world/_ide/bootimage/boot.bin</span></code>.</p>
</div>
<div class="section" id="boot-freertos-on-platform">
<h3>Boot FreeRTOS on platform<a class="headerlink" href="#boot-freertos-on-platform" title="Permalink to this heading">¶</a></h3>
<p>There are many ways one can boot FreeRTOS with the artifacts created - we provide a few ideas here but there are more ways such as USB, eMMC, ethernet - all of which are not specific to Kria implementation.</p>
<div class="section" id="boot-freertos-vis-jtag">
<h4>Boot FreeRTOS vis JTAG<a class="headerlink" href="#boot-freertos-vis-jtag" title="Permalink to this heading">¶</a></h4>
<p>To boot freeRTOS via JTAG, we will use XSDB. Create a folder with <code class="docutils literal notranslate"><span class="pre">freertos_hello_world.elf</span></code>, <code class="docutils literal notranslate"><span class="pre">fsbl.elf</span></code> and <code class="docutils literal notranslate"><span class="pre">pmufw.elf</span></code> in the folder. Create a boot.sh in the same folder with the following content:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>puts stderr <span class="s2">&quot;Starting the script...&quot;</span>
connect
targets -set -nocase -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;PSU&quot;</span><span class="o">}</span>
<span class="c1"># update multiboot to ZERO</span>
mwr 0xffca0010 0x0
<span class="c1"># change boot mode to JTAG</span>
mwr 0xff5e0200 0x0100
<span class="c1"># reset</span>
rst -system
after <span class="m">2000</span>

targets -set -nocase -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;PSU&quot;</span><span class="o">}</span>
mwr  0xffca0038 0x1ff
targets -set -nocase -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;MicroBlaze PMU&quot;</span><span class="o">}</span>
catch <span class="o">{</span>stop<span class="o">}</span><span class="p">;</span> after <span class="m">1000</span>
puts stderr <span class="s2">&quot;INFO: Downloading zynqmp_pmufw ELF file to the target.&quot;</span>
dow -force <span class="s2">&quot;pmufw.elf&quot;</span>
after <span class="m">2000</span>
con

after <span class="m">5000</span>
targets -set -nocase -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;Cortex-A53*#0&quot;</span><span class="o">}</span>
rst -proc -clear-registers
after <span class="m">2000</span>
puts stderr <span class="s2">&quot;INFO: Downloading zynqmp_fsbl ELF file to the target.&quot;</span>
dow -force <span class="s2">&quot;fsbl.elf&quot;</span>
after <span class="m">2000</span>
con
after <span class="m">4000</span><span class="p">;</span> stop<span class="p">;</span> catch <span class="o">{</span>stop<span class="o">}</span><span class="p">;</span>

targets -set -nocase -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;*A53*#0&quot;</span><span class="o">}</span>
puts stderr <span class="s2">&quot;INFO: Downloading u-boot ELF file to the target.&quot;</span>
after <span class="m">2000</span>
dow -force <span class="s2">&quot;freertos_hello_world.elf&quot;</span>
after <span class="m">2000</span>
con
</pre></div>
</div>
<p>In XSDB, source boot.sh, this will execute the three elfs and execute the example freeRTOS hello world application. You will freeRTOS Hello World application prints on UART.</p>
</div>
<div class="section" id="boot-freertos-using-qspi-in-a-b-update">
<h4>Boot FreeRTOS Using QSPI in A/B update<a class="headerlink" href="#boot-freertos-using-qspi-in-a-b-update" title="Permalink to this heading">¶</a></h4>
<p>If your Starter Kit has the locked QSPI image with A/B boot sections, you can also test the generated boot.bin (renamed to freertos_boot.bin here) by loading it to A or B boot partition and test.</p>
<p>For an example, you can boot to Ubuntu/PetaLinux and load the freertos_boot.bin into one of the image partition using xmutil:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ubuntu@kria:~$ sudo xmutil bootfw_update -i freertos_boot.bin
Marking last booted image as bootable
Reading Image file
Updating Image B
Marking target image as non bootable
Writing Image to Image B partition
Marking target image as non bootable and requested image
Clearing multiboot register value
freertos_boot.bin successfully updated to Image B partition
</pre></div>
</div>
<p>Perform a power cycle - on the first power cycle, image selector will choose the newly updated partition  - you will see hello freeRTOS program printouts on UART. However, note that in this state, on every other power cycle, the image selector will choose the other partition and try to boot Linux. For detailed logics on how image selector chooses which partition to use, see <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw/build/html/docs/bootfw_overview.html#a-b-boot-concept">a/b boot concept</a> section.</p>
</div>
</div>
</div>
<div class="section" id="next-step">
<h2>Next Step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h2>
<p>Try the lwIP TCP Performance Server application in <a class="reference internal" href="freertos_kria_lwip_tcpperfserver.html"><span class="doc">this tutorial</span></a></p>
<hr class="sphinxhide"></hr><p class="sphinxhide" align="center"><sub>Copyright © 2024 Advanced Micro Devices, Inc.</sub></p><p class="sphinxhide" align="center"><sup><a href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></sup></p></div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="FreeRTOS Kria SOM Starter Kits Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="freertos_kria_lwip_tcpperfserver.html" class="btn btn-neutral float-right" title="FreeRTOS Kria SOM Starter Kits lwIP TCP Performance Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on March 26, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>