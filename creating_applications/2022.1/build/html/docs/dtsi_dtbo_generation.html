<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Generating DTSI and DTBO Overlay Files &mdash; Kria™ SOM 2022.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bitstream Management on Kria SOM" href="bitstream_management.html" />
    <link rel="prev" title="Setting Bootmodes" href="bootmodes.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> Kria™ SOM
            <img src="../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/Kria_doc_map/map.htm">Kria Adventure Map</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/freertos.html">FreeRTOS Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Flows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Development Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="vitis_accel_flow.html">Vitis Accelerator Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="vitis_platform_flow.html">Vitis Platform Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="vivado_accel_flow.html">Vivado Accelerator Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_cc_flow.html">Custom Carrier Card Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="baremetal.html">Bare-metal Flow Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kria Vitis Acceleration Flow</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="kria_vitis_acceleration_flow/kria-vitis-acceleration.html">Kria Vitis Acceleration Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Utilities</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="target.html">On-target Utilities and Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootmodes.html">Setting Bootmodes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generating DTSI and DTBO Overlay Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-xsct-dtg-and-dtc">Using XSCT, DTG and DTC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tools-and-input-required">Tools and Input Required</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-dtsi-from-xsa-using-dtg">Generate .dtsi from .xsa using DTG</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compile-the-dtsi-to-dtbo-using-dtc">Compile the .dtsi to .dtbo using DTC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-dfx-user-dts-bbclass-in-yocto">Using dfx_user_dts bbclass in Yocto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Tools and Input required</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-dtbo-file">Creating .dtbo file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-fpgamanger-custom-bbclass-in-petalinux">Using fpgamanger_custom bbclass in PetaLinux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Tools and Input required</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-dtbo-file-yocto">Generate .dtbo file (Yocto)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-dtbo-file">Generate .dtbo file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-fpgamanger-dtg-bbclass-in-petalinux">Using fpgamanger_dtg bbclass in PetaLinux</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Tools and Input required</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Generate .dtbo file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bitstream_management.html">Bitstream Management on Kria SOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="AI_customization.html">AI Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Generate_vivado_project_from_boardfile.html">Generate a Vivado Project from Board Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="IPMI_EEPROM_design_guide.html">Kria SOM EEPROM Design Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="EEPROM_mapping_for_Kria_products.html">Kria SOM EEPROM Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="FTDI_EEPROM_design_guide.html">Kria SOM CC FTDI Design Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Releases</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications/2021.1/build/html/index.html">2021.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kria™ SOM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Generating DTSI and DTBO Overlay Files</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/dtsi_dtbo_generation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="generating-dtsi-and-dtbo-overlay-files">
<h1>Generating DTSI and DTBO Overlay Files<a class="headerlink" href="#generating-dtsi-and-dtbo-overlay-files" title="Permalink to this heading">¶</a></h1>
<p>In this step the AMD HW description captured in the custom PL design must be translated into a Linux understandable format. In Linux HW is described using a concept called device trees (DT). The human readable form of these are dts and dtsi files. The PL design is loaded post Linux boot, therefore this step generates a DT overlay. The overlay DT is slightly different than the Linux boot DT - it must define “fragments” that are added dynamically by Linux at runtime.</p>
<p>For reference, the .dtsi files associated with each platform (but organized by application) can be found in <a class="reference external" href="https://github.com/Xilinx/kria-apps-firmware">Kria app firmware</a></p>
<p>The dts/dtsi files can be generated in a number of ways, all of which require the HW description data captured in the XSA or bit file. After a .dtsi file is generated, it is then compiled into a binary .dtbo file. The .dtbo file is expected in firmware folder for each applications.</p>
<p>Here are the three recommended ways:</p>
<ol class="simple">
<li><p>In AMD Software Command-Line Tools (XSCT), use Device Tree Generator (DTG) and .xsa file to generate .dtsi, and Device Tree Compiler (DTC) to compile a .dtbo file</p></li>
<li><p>Manually create .dtsi file, and in Yocto, use dfx_user_dts bbclass to create .dtbo</p></li>
<li><p>Manually create .dtsi file, and in PetaLinux, use fpgamanger_custom bbclass to create .dtbo</p></li>
<li><p>In PetaLinux, use fpgamanger_dtg bbclass tools and petalinux-build to generate .dtsi file from .xsa file, and compiling it into .dtbo.</p></li>
</ol>
<p>Note that with any ways of generating DTSI files - the generated .dtsi file will likely require user modification before they can be fully functional.</p>
<div class="section" id="using-xsct-dtg-and-dtc">
<h2>Using XSCT, DTG and DTC<a class="headerlink" href="#using-xsct-dtg-and-dtc" title="Permalink to this heading">¶</a></h2>
<div class="section" id="tools-and-input-required">
<h3>Tools and Input Required<a class="headerlink" href="#tools-and-input-required" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>XSCT (part of Vivado or Vitis installation)</p></li>
<li><p>DTG, make sure to check out the version that is aligned to rest of tool chain and BSP used:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/Xilinx/device-tree-xlnx
<span class="nb">cd</span> device-tree-xlnx
git checkout xlnx_rel_v&lt;version&gt;
</pre></div>
</div>
</li>
<li><p>DTC (part of Vitis installation, can also be obtained below:)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://git.kernel.org/pub/scm/utils/dtc/dtc.git
<span class="nb">cd</span> dtc
make
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/&lt;path-to-dtc&gt;/dtc
</pre></div>
</div>
</li>
</ol>
<p>More information about using Xilinx’s Device Tree Generator (DTG) and open source Device Tree Compiler (DTC) can be found in <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842279/Build+Device+Tree+Blob">wiki page</a>.</p>
<p>The following hardware design hand-off artifacts are required:</p>
<ol class="simple">
<li><p>XSA file - applies to Vivado or Vitis designs</p></li>
</ol>
</div>
<div class="section" id="generate-dtsi-from-xsa-using-dtg">
<h3>Generate .dtsi from .xsa using DTG<a class="headerlink" href="#generate-dtsi-from-xsa-using-dtg" title="Permalink to this heading">¶</a></h3>
<p>Use XSCT to call HSI &amp; generate DTSI.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hsi open_hw_design &lt;design_name.xsa&gt;
hsi set_repo_path &lt;path to device-tree-xlnx repository&gt;
hsi create_sw_design device-tree -os device_tree -proc psu_cortexa53_0
hsi set_property CONFIG.dt_overlay <span class="nb">true</span> <span class="o">[</span>hsi::get_os<span class="o">]</span>
hsi set_property CONFIG.dt_zocl <span class="nb">true</span> <span class="o">[</span>hsi get_os<span class="o">]</span>          <span class="c1"># if ZOCL is used</span>
hsi generate_target -dir &lt;desired_dts_filename&gt;
hsi close_hw_design <span class="o">[</span>current_hw_design<span class="o">]</span>
</pre></div>
</div>
<p>[current_hw_design] name can be found in output of hsi open_hw_design &lt;design_name.xsa&gt;. An example script for above can be found in the linked example from Vitis Platform Flow <a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/2022.1/Vitis_Platform_Creation/Design_Tutorials/01-Edge-KV260/ref_files/step2_pfm/gen_dt.tcl">here</a>.</p>
<p>A folder &lt;desired_dts_filename&gt; will be created, pl.dtsi is the overlay .dtsi file to be used to compile into .dtbo file. The .dtsi file will require some user modification before it is ready to be compiled.</p>
</div>
<div class="section" id="compile-the-dtsi-to-dtbo-using-dtc">
<h3>Compile the .dtsi to .dtbo using DTC<a class="headerlink" href="#compile-the-dtsi-to-dtbo-using-dtc" title="Permalink to this heading">¶</a></h3>
<p>This step takes the human readable defined Linux HW description (dtsi file) generated (.pl.dtsi)and compiles it into a binary form that Linux can directly use. This is completed using the Linux Device Tree Compiler (DTC) which is an opensource tool. The actual command used to generate the desired dtbo from the dtsi file is shown below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dtc -@ -O dtb -o pl.dtbo pl.dtsi
</pre></div>
</div>
<p>Rename the pl.dtbo to the appropriate name.</p>
</div>
</div>
<div class="section" id="using-dfx-user-dts-bbclass-in-yocto">
<h2>Using dfx_user_dts bbclass in Yocto<a class="headerlink" href="#using-dfx-user-dts-bbclass-in-yocto" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">dfx_user_dts</span></code> bitbake class is a helper class that can be used by Yocto to generate a set of FPGA firmware binaries. This method requires that user hand write their own .dtsi file. This has been supported starting in 2024.1. The same bitbake class applies for PetaLinux, but this section aims to provide an example of how to use this bitbake class in Yocto.</p>
<div class="section" id="id1">
<h3>Tools and Input required<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>Yocto of the appropriate version (but must be 2023.2 and later)</p></li>
<li><p>Yocto project for Kria SOM of the appropriate version, created by following instructions in <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto/build/html/docs/yocto_kria_support.html#prepare-the-build-environment">Prepare the Build Environment</a></p></li>
</ol>
<p>The following hardware design hand-off artifacts are required:</p>
<ol class="simple">
<li><p>PL bitstream - applies to Vivado or Vitis designs</p></li>
<li><p>Device tree overlay source file - the user needs to create this file based on the PL hardware design</p></li>
<li><p>json file - specifies if the overlay is slotted or flat and required by dfx-mgr. More information can be found <a class="reference internal" href="target.html"><span class="doc">here</span></a></p></li>
<li><p>Xclbin file - only applies to Vitis designs</p></li>
</ol>
</div>
<div class="section" id="creating-dtbo-file">
<h3>Creating .dtbo file<a class="headerlink" href="#creating-dtbo-file" title="Permalink to this heading">¶</a></h3>
<p>After following <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto/build/html/docs/yocto_kria_support.html#prepare-the-build-environment">Prepare the Build Environment</a> instructions, you should be in <code class="docutils literal notranslate"><span class="pre">$yocto_workspace/build</span></code>.</p>
<p>Create a folder <code class="docutils literal notranslate"><span class="pre">$yocto_workspace/sources/meta-kria/recipes-firmware/&lt;firmware-name&gt;/files</span></code>. Put the artifacts, <code class="docutils literal notranslate"><span class="pre">&lt;firmware-name&gt;.dtsi</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;firmware-name&gt;.bit</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;firmware-name&gt;.xclbin</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;firmware-name&gt;.dtsi</span></code> in the folder created.</p>
<p>Create a file <code class="docutils literal notranslate"><span class="pre">$yocto_workspace/sources/meta-kria/recipes-firmware/&lt;firmware-name&gt;/&lt;firmware-name&gt;.bb</span></code> with the following content. You can find the appropriate <code class="docutils literal notranslate"><span class="pre">&lt;machine-name&gt;</span></code> in <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto/build/html/docs/yocto_kria_support.html">Kria Yocto Support page</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>LICENSE = &quot;MIT&quot;
LIC_FILES_CHKSUM = &quot;file://${COMMON_LICENSE_DIR}/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&quot;

inherit dfx_user_dts

SRC_URI = &quot;\
    file://&lt;firmware-name&gt;.bit \
    file://&lt;firmware-name&gt;.dtsi \
    file://shell.json \
    file://&lt;firmware-name&gt;.xclbin \
    &quot;

COMPATIBLE_MACHINE ?= &quot;^$&quot;
COMPATIBLE_MACHINE:&lt;machine-name&gt; = &quot;&lt;machine-name&gt;&quot;
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">$yocto_workspace/build/conf/local.conf</span></code>, add the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MACHINE_FEATURES</span> <span class="o">+=</span> <span class="s2">&quot;fpga-overlay&quot;</span>
<span class="n">IMAGE_INSTALL</span><span class="p">:</span><span class="n">append</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\</span>
<span class="s2">        &lt;firmware-name&gt; </span><span class="se">\</span>
<span class="s2">        fpga-manager-script </span><span class="se">\</span>
<span class="s2">        &quot;</span>
</pre></div>
</div>
<p>You can then bitbake the recipe with the command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="n">MACHINE</span><span class="o">=&lt;</span><span class="n">machine</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">bitbake</span> <span class="o">&lt;</span><span class="n">firmware</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> 
</pre></div>
</div>
<p>You can find the compiled .dtbo files in various locations in <code class="docutils literal notranslate"><span class="pre">$yocto_workspace/build</span></code> using command <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">*</span> <span class="pre">-iname</span> <span class="pre">&lt;firmware-name&gt;.dtbo</span></code>.</p>
<p>If you build the wic image using command below, you will then find the firmware(.bit.bin, .dtbo, .xclbin, .json files) on target in <code class="docutils literal notranslate"><span class="pre">/lib/firmware/xilinx/&lt;firmware-name&gt;</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MACHINE</span><span class="o">=&lt;</span><span class="n">machine</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">bitbake</span> <span class="n">kria</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">full</span><span class="o">-</span><span class="n">cmdline</span> 
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-fpgamanger-custom-bbclass-in-petalinux">
<h2>Using fpgamanger_custom bbclass in PetaLinux<a class="headerlink" href="#using-fpgamanger-custom-bbclass-in-petalinux" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">fpgamanager_custom</span></code> bitbake class is a helper class to generate a set of FPGA firmware binaries. This method requires that user hand write their own .dtsi file. This has been depreciated starting in 2024.1. The same bitbake class applies for Yocto, but this section aims to provide an example of how to use this bitbake class in PetaLinux.</p>
<div class="section" id="id2">
<h3>Tools and Input required<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>Petalinux of the appropriate version</p></li>
<li><p>SOM BSP of the appropriate release</p></li>
</ol>
<p>The following hardware design hand-off artifacts are required:</p>
<ol class="simple">
<li><p>PL bitstream - applies to Vivado or Vitis designs</p></li>
<li><p>Device tree overlay source file - the user needs to create this file based on the PL hardware design</p></li>
<li><p>json file - specifies if the overlay is slotted or flat and required by dfx-mgr. More information can be found <a class="reference internal" href="target.html"><span class="doc">here</span></a></p></li>
<li><p>Xclbin file - only applies to Vitis designs</p></li>
</ol>
</div>
<div class="section" id="generate-dtbo-file-yocto">
<h3>Generate .dtbo file (Yocto)<a class="headerlink" href="#generate-dtbo-file-yocto" title="Permalink to this heading">¶</a></h3>
<p>Please refer to <a class="reference external" href="https://github.com/Xilinx/kria-apps-firmware">Kria apps firmware</a> for example dtsi files
based on the <code class="docutils literal notranslate"><span class="pre">fpgamanager_custom</span></code> class used in the AMD accelerated applications.</p>
<p>First. create</p>
</div>
<div class="section" id="generate-dtbo-file">
<h3>Generate .dtbo file<a class="headerlink" href="#generate-dtbo-file" title="Permalink to this heading">¶</a></h3>
<p>Please refer to <a class="reference external" href="https://github.com/Xilinx/kria-apps-firmware">Kria apps firmware</a> for example dtsi files
based on the <code class="docutils literal notranslate"><span class="pre">fpgamanager_custom</span></code> class used in the AMD accelerated applications.</p>
<p>First, run the following command to create a new Petalinux project from the provided  SOM bsp file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-&lt;board&gt;-&lt;version&gt;.bsp
<span class="nb">cd</span> xilinx-&lt;board&gt;-&lt;version&gt;
</pre></div>
</div>
<p>The following steps assume you have created a petalinux project and built it. If the project has not been build, run this command to configure the project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-config --silentconfig 
</pre></div>
</div>
<p>Run the following command to generate a new firmware recipe:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-create -t apps --template fpgamanager -n user-firmware --enable --srcuri <span class="s2">&quot;user.bit user.dtsi user.xclbin shell.json&quot;</span>
</pre></div>
</div>
<p>The generated recipe will be located at
<code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-apps/user-firmware/user-firmware.bb</span></code></p>
<p>The recipe contains the minimum required elements but can be further customized
by the user for their needs.</p>
<p>Then the .dtbo file will be generated when building petalinux again.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-build
</pre></div>
</div>
<p>The newly generated .dtbo file can be found at <code class="docutils literal notranslate"><span class="pre">$tmp_folder/sysroots-components/zynqmp_generic/user-firmware/lib/firmware/xilinx/user-firmware/user-firmware.dtbo</span></code>
$tmp_folder location can be found at <code class="docutils literal notranslate"><span class="pre">project-spec/configs/config</span> <span class="pre">CONFIG_TMP_DIR_LOCATION=$tmp_folder</span></code></p>
</div>
</div>
<div class="section" id="using-fpgamanger-dtg-bbclass-in-petalinux">
<h2>Using fpgamanger_dtg bbclass in PetaLinux<a class="headerlink" href="#using-fpgamanger-dtg-bbclass-in-petalinux" title="Permalink to this heading">¶</a></h2>
<p>Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">fpgamanager_dtg</span></code> bitbake class which uses the AMD device tree generator (dtg) to generate a device tree overlay from a Vivado or Vitis-generated XSA file.</p>
<div class="section" id="id3">
<h3>Tools and Input required<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>Petalinux of the appropriate version</p></li>
<li><p>SOM BSP of the appropriate release</p></li>
</ol>
<p>The following hardware design hand-off artifacts are required:</p>
<ol class="simple">
<li><p>XSA file (must include bitstream) - applies to Vivado or Vitis designs</p></li>
<li><p>json file - specifies if the overlay is slotted or flat and required by dfx-mgr. More information can be found <a class="reference internal" href="target.html"><span class="doc">here</span></a></p></li>
<li><p>Xclbin file - only applies to Vitis designs</p></li>
<li><p>dtsi file is not required and will be generated, but the user can optionally add a device tree source
file that will be appended to the dtg-generated device tree file</p></li>
</ol>
</div>
<div class="section" id="id4">
<h3>Generate .dtbo file<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>First, run the following command to create a new PetaLinux project from the provided SOM bsp file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-&lt;board&gt;-&lt;version&gt;.bsp
<span class="nb">cd</span> xilinx-&lt;board&gt;-&lt;version&gt;
</pre></div>
</div>
<p>The following steps assume you have created a petalinux project and built it. If the project has not been build, run this command to configure the project:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-config --silentconfig 
</pre></div>
</div>
<p>Run the following command to generate a new firmware recipe:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-create -t apps --template fpgamanager_dtg -n user-firmware --enable --srcuri <span class="s2">&quot;user.xsa user.xclbin shell.json&quot;</span>
</pre></div>
</div>
<p>The generated recipe will be located at
<code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-apps/user-firmware/user-firmware.bb</span></code></p>
<p>The recipe contains the minimum required elements but can be further customized by the user for their needs. If you want to inspect the generated .dtsi file without petalinux/yocto cleaning things up after a successful build, add this variable into your recipe:
<code class="docutils literal notranslate"><span class="pre">RM_WORK_EXCLUDE</span> <span class="pre">+=</span> <span class="pre">&quot;${PN}&quot;</span></code>
The .dtsi file can be found in <code class="docutils literal notranslate"><span class="pre">&lt;tmpworkspace&gt;/work/zynqmp_generic-xilinx-linux/user-firmware/1.0-r0/build/user-firmware/pl.dtsi</span></code></p>
<p>Then the .dtbo file will be generated when building PetaLinux again.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-build
</pre></div>
</div>
<p>The newly generated .dtbo file can be found at <code class="docutils literal notranslate"><span class="pre">$tmp_folder/sysroots-components/zynqmp_generic/user-firmware/lib/firmware/xilinx/user-firmware/user-firmware.dtbo</span></code>
$tmp_folder location can be found at <code class="docutils literal notranslate"><span class="pre">project-spec/configs/config</span> <span class="pre">CONFIG_TMP_DIR_LOCATION=$tmp_folder</span></code></p>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>A step by step example for generating the .dtbo file for smartcam from its platform .xsa file can be found <a class="reference internal" href="dtsi_dtbo_generation_smartcam_example.html"><span class="doc">here</span></a>.</p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h2>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p class="sphinxhide" align="center">Copyright&copy; 2023 Advanced Micro Devices, Inc</p></div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bootmodes.html" class="btn btn-neutral float-left" title="Setting Bootmodes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bitstream_management.html" class="btn btn-neutral float-right" title="Bitstream Management on Kria SOM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on March 26, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>