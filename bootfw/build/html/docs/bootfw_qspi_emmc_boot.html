<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Boot Firmware - QSPI to eMMC boot for Production SOM &mdash; Boot SOM Firmware 2022.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> Boot SOM Firmware
            <img src="../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs//creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs//ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs//openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs//drm.html">Digital Rights Management</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs//dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs//ipmi_eeprom.html">IPMI EEPROM Design Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Boot Firmware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bootfw_overview.html">Boot Firmware Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_image_selector.html">Boot Firmware - Image Selector</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_image_recovery.html">Boot Firmware Image Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_pmu_config_obj.html">Boot Firmware - PMU Overlay Config Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_uboot_handoff.html">Boot Firmware - U-Boot Handoff</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Boot SOM Firmware</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Boot Firmware - QSPI to eMMC boot for Production SOM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/bootfw_qspi_emmc_boot.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="boot-firmware-qspi-to-emmc-boot-for-production-som">
<h1>Boot Firmware - QSPI to eMMC boot for Production SOM<a class="headerlink" href="#boot-firmware-qspi-to-emmc-boot-for-production-som" title="Permalink to this heading">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>The production SOM has an eMMC device populated, whereas the Starter Kit SOMs do not. Therefore, instead of Starter Kit’s QSPI-&gt;SD two stage boot process, developer can do a QSPI -&gt; eMMC two stage process on the production SOM. This page gives an example of how to boot from QSPI -&gt; eMMC.</p>
<p>User can also use the traditional monolithic boot (from eMMC) for production SOMs by using eMMC boot mode and placing boot files in eMMC. This method is not covered by this document.</p>
</div>
<div class="section" id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this heading">¶</a></h2>
<ol class="simple">
<li><p>Have finished Getting started with Kria SOM <a class="reference external" href="https://www.xilinx.com/products/som/kria/kv260-vision-starter-kit/kv260-getting-started/getting-started.html">KV260</a> or <a class="reference external" href="https://www.xilinx.com/products/som/kria/kr260-robotics-starter-kit/kr260-getting-started/getting-started.html">KR260</a></p></li>
<li><p>Have read <a class="reference internal" href="bootfw_overview.html"><span class="doc">bootfw overview</span></a> and its associated contents</p></li>
<li><p>Vivado or Vivado labs installed on host computer</p></li>
</ol>
</div>
<div class="section" id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this heading">¶</a></h2>
<p>There are many different ways to get a Production SOM to boot from QSPI to eMMC. Here are the outlines of the steps:</p>
<ol>
<li><p>Program production SOM with QSPI binary, there are 2 ways to do this:</p>
<p>1.A Program QSPI using XSDB/XSCT and u-boot</p>
<p>1.B Program QSPI using Vivado Labs</p>
</li>
<li><p>Program Production SOM eMMC with Linux Image, there are 2 days to do this:</p>
<p>2.A Program Production SOM eMMC with Image Recovery App (does not support Ubuntu)</p>
<p>2.B Program Production SOM eMMC with Linux Image using Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">first</span> <span class="n">boot</span> <span class="n">Linux</span> <span class="k">with</span> <span class="n">eMMC</span> <span class="n">awareness</span><span class="p">,</span> <span class="ow">and</span> <span class="n">there</span> <span class="n">are</span> <span class="mi">2</span> <span class="n">days</span> <span class="n">to</span> <span class="n">do</span> <span class="n">this</span> <span class="n">too</span><span class="p">:</span>
     <span class="mf">2.</span><span class="n">B</span><span class="o">.</span><span class="n">a</span><span class="o">.</span> <span class="n">Boot</span> <span class="n">Linux</span> <span class="n">using</span> <span class="n">petalinux</span><span class="o">-</span><span class="n">boot</span>
     <span class="mf">2.</span><span class="n">B</span><span class="o">.</span><span class="n">b</span><span class="o">.</span> <span class="n">Boot</span> <span class="n">Linux</span> <span class="n">through</span> <span class="n">SD</span>
 <span class="n">Write</span> <span class="n">to</span> <span class="n">eMMC</span> <span class="ow">in</span> <span class="n">Linux</span>
</pre></div>
</div>
</li>
<li><p>reboot in QSPI mode</p></li>
</ol>
<div class="section" id="program-production-som-with-qspi-binary">
<h3>1. Program Production SOM with QSPI binary<a class="headerlink" href="#program-production-som-with-qspi-binary" title="Permalink to this heading">¶</a></h3>
<p>Unlike Starter Kit SOM, the production SOM is shipped without QSPI pre-populated. So developer first need to program QSPI with the appropriate boot firmware so that SOM will boot first in QSPI and hand off to Linux image in eMMC. The QSPI binary for Starter Kit SOM is not released, however, each components can be generated as outlined in <a class="reference internal" href="bootfw_overview.html"><span class="doc">bootfw overview</span></a> and its pages. As a reference and an example for this guide, developer can use <a class="reference internal" href="bootfw_qspi_stitching.html"><span class="doc">bootfw recipe in Yocto</span></a> to generate an example QSPI binary for either KV260 or KR260 and program the QSPI image to Kria production SOM.</p>
<p>Once you have a QSPI binary .bin file, it is time to program it to the board. Mount the Kria Production SOM onto a carrier card, connect it to a host computer using micro-usb cable or the Xilinx Platform cable. Leave SD card slot empty and connect to power.</p>
<p>There are two ways to program the QSPI, through Vivado Labs with XSDB/XSCT, or through XSDB/XSCT only.</p>
<div class="section" id="a-program-qspi-using-xsdb-xsct-and-u-boot">
<h4>1A Program QSPI using XSDB/XSCT and u-boot<a class="headerlink" href="#a-program-qspi-using-xsdb-xsct-and-u-boot" title="Permalink to this heading">¶</a></h4>
<p>To program the QSPI using XSDB/XSCT only, download <a class="reference external" href="./example_src/boot.tcl">boot.tcl</a> file and put them in a &lt;working_folder/&gt; along with &lt;QSPI_image&gt;.bin. Then download the <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#PetaLinux-Board-Support-Packages">appropriate production .bsp file</a> for production SOM card (e.g. xilinx-k26-som-<version>.bsp). Once downloaded, extract the bsp file and copy the artifacts needed for boot.tcl into &lt;working_folder/&gt;</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-&lt;board&gt;-&lt;version&gt;.bsp
<span class="nb">cd</span> xilinx-&lt;board&gt;-&lt;version&gt;/pre-built/linux/images/
cp bl31.elf pmufw.elf system.dtb u-boot.elf zynqmp_fsbl.elf &lt;working_folder/&gt;
</pre></div>
</div>
<p>Connect the serial port of carrier card with a uart listener so we can work in u-boot. Power on the board.</p>
<p>In xsdb/xsct, cd to &lt;working_folder/&gt; and source boot.tcl:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> boot.tcl
</pre></div>
</div>
<p>This will boot u-boot on the board. In the uart listener there should be print outs from u-boot. Once at u-boot prompt, go back to xsdb and copy the QSPI image to DDR:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dow -force -data &lt;QSPI image&gt;.bin &lt;ddr address&gt;
</pre></div>
</div>
<p>example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dow -force -data &lt;QSPI image&gt;.bin 0x80000
</pre></div>
</div>
<p>In u-boot, write the QSPI image in DDR to QSPI:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ZynqMP&gt; sf probe 0x0 0x0 0x0 
ZynqMP&gt; sf erase &lt;offset address on flash&gt; &lt;greater than the size qspi bin&gt;
ZynqMP&gt; sf write &lt;ddr address&gt; &lt;offset address on flash&gt; &lt;greater than the size qspi bin&gt;
</pre></div>
</div>
<p>example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ZynqMP&gt; sf probe 0x0 0x0 0x0 
ZynqMP&gt; sf erase 0x0 0x3000000  
ZynqMP&gt; sf write 0x80000 0x0 0x3000000 
</pre></div>
</div>
<p>Now QSPI has been programmed!</p>
</div>
<div class="section" id="b-program-qspi-using-vivado-labs">
<h4>1B Program QSPI using Vivado Labs<a class="headerlink" href="#b-program-qspi-using-vivado-labs" title="Permalink to this heading">¶</a></h4>
<p>We first need to set SOM to JTAG boot mode. Start XSDB or XSCT and put it in JTAG boot:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>connect
targets -set -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;PSU&quot;</span><span class="o">}</span>
mwr 0xffca0010 0x0
mwr 0xff5e0200 0x0100
rst -system
</pre></div>
</div>
<p>On the host computer, start Vivado or Vivado labs. In Vivado or Vivado Labs’ starting window, click on “Open Hardware Manager”.</p>
<p>open target (on the green line) → open new target → next → select local server, next → select the right target in Hardware Targets, and in Hardware Devices select xck26_0 → next → finish</p>
<p><img alt="image" src="../_images/qspi_program_1.PNG" /></p>
<p>right click on target (xck26_0) → select Add Configuration Memory Device</p>
<p><img alt="image" src="../_images/qspi_program_2.PNG" /></p>
<p>search and choose <code class="docutils literal notranslate"><span class="pre">mt25qu512-qspi-x4-single</span></code> and click OK</p>
<p><img alt="image" src="../_images/qspi_program_3.PNG" /></p>
<p>Click “OK” for “Do you want to program the configuration memory device now?”</p>
<p>Supply qspi .bin and fsbl files (produced in <a class="reference internal" href="bootfw_qspi_stitching.html"><span class="doc">QSPI stitching</span></a> tutorial), make sure to select Entire Configuration Memory Device, erase, program, verify, and click okay.</p>
<p><img alt="image" src="../_images/qspi_program_4.PNG" /></p>
<p>This may take up to 10 min. At the end, there is a warning <code class="docutils literal notranslate"><span class="pre">[Xicom</span> <span class="pre">50-100]</span> <span class="pre">The</span> <span class="pre">current</span> <span class="pre">boot</span> <span class="pre">mode</span> <span class="pre">is</span> <span class="pre">QSPI32.</span> <span class="pre">Flash</span> <span class="pre">programming</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">supported</span> <span class="pre">with</span> <span class="pre">the</span> <span class="pre">selected</span> <span class="pre">boot</span> <span class="pre">mode.If</span> <span class="pre">flash</span> <span class="pre">programming</span> <span class="pre">fails,</span> <span class="pre">configure</span> <span class="pre">device</span> <span class="pre">for</span> <span class="pre">JTAG</span> <span class="pre">boot</span> <span class="pre">mode</span> <span class="pre">and</span> <span class="pre">try</span> <span class="pre">again.</span></code> - it can be ignored.</p>
<p>Exit Vivado or Vivado Lab.</p>
<p>Now QSPI is programmed with an image that contains boot.bin files and image recovery app. They will be used in the following section.</p>
</div>
</div>
<div class="section" id="program-production-som-emmc-with-linux-image">
<h3>2. Program Production SOM eMMC with Linux Image<a class="headerlink" href="#program-production-som-emmc-with-linux-image" title="Permalink to this heading">¶</a></h3>
<p>There are two ways to program the eMMC - using image recovery application or using Linux.</p>
<div class="section" id="a-program-production-som-emmc-with-image-recovery-app">
<h4>2A Program Production SOM eMMC with Image Recovery App<a class="headerlink" href="#a-program-production-som-emmc-with-image-recovery-app" title="Permalink to this heading">¶</a></h4>
<p>For details on set-up and use of the Recovery Tool, see <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1089-kv260-starter-kit">UG1089</a> for KV260 and <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1092-kr260-starter-kit">UG1092</a> for KR260.</p>
<p>The recovery tool currently only support .wic image upload, therefore it does not yet support Ubuntu. It has a limit of 4GB for .wic image upload. So we will need to reduce the wic image to 2GB, using .5G for boot and 1.5G for rootfs. update build/rootfs.wks in PetaLinux work folder:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>part /boot --source bootimg-partition --ondisk mmcblk0 --fstype<span class="o">=</span>vfat --label boot --active --align <span class="m">4</span> --fixed-size 500M
part / --source rootfs --ondisk mmcblk0 --fstype<span class="o">=</span>ext4 --label root --align <span class="m">4</span> --fixed-size 1500M
</pre></div>
</div>
<p>Note that after booting, we can use <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications/2022.1/build/html/docs/target.html#resize-part">re-size</a> tool to expand rootfs.</p>
<p>Then generate the .wic image to run out of eMMC (mmcblk0):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-package --wic --bootfiles <span class="s2">&quot;ramdisk.cpio.gz.u-boot boot.scr Image system.dtb&quot;</span> --wks build/rootfs.wks --disk-name <span class="s2">&quot;mmcblk0&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-program-production-som-emmc-with-linux-image-using-linux">
<h3>2B Program Production SOM eMMC with Linux Image using Linux<a class="headerlink" href="#b-program-production-som-emmc-with-linux-image-using-linux" title="Permalink to this heading">¶</a></h3>
<p>To write to eMMC from Linux, we first need to boot Linux that has eMMC awareness.
We can either do petalinux-boot –jtag or boot from SD card for now assuming that there’s a SD card on the CC.</p>
<div class="section" id="b-a-boot-linux-using-petalinux-boot">
<h4>2.B.a. Boot Linux using petalinux-boot<a class="headerlink" href="#b-a-boot-linux-using-petalinux-boot" title="Permalink to this heading">¶</a></h4>
<p>To use petalinux-boot, refer to <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1144-petalinux-tools-reference-guide/Steps-to-Boot-a-PetaLinux-Image-on-Hardware-with-JTAG">Petalinux Jtag Boot</a>. Developer should download the <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#PetaLinux-Board-Support-Packages">Production K26 SOM BSP</a>.</p>
<p>On the host connected to the board, start xsdb and put the board in JTAG bootmode:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>connect 
targets -set -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;PSU&quot;</span><span class="o">}</span>
mwr -force 0xffca0010 0x0<span class="p">;</span> mwr -force 0xff5e0200 0x0100
rst -system
</pre></div>
</div>
<p>On the host with K26 BSP (make sure to use K26 BSP which has eMMC awareness):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-k26-som-&lt;version&gt;.bsp
<span class="nb">cd</span> xilinx-k26-som-&lt;version&gt;
petalinux-boot --jtag --prebuilt <span class="m">3</span> --hw_server-url &lt;hostname:3121&gt;
</pre></div>
</div>
<p>on the host connected to the board, in the uart console, stop at u-boot and enter the following:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>booti 0x00200000 0x04000000 0x00100000
</pre></div>
</div>
<p>This will boot a Linux with tinyFS, and you can ignore the error <code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">There's</span> <span class="pre">no</span> <span class="pre">'/dev'</span> <span class="pre">on</span> <span class="pre">rootfs.</span></code> because tiny FS does not provide /dev folder.</p>
</div>
<div class="section" id="b-b-boot-linux-through-sd">
<h4>2.B.b. Boot Linux through SD<a class="headerlink" href="#b-b-boot-linux-through-sd" title="Permalink to this heading">¶</a></h4>
<p>Alternatively, program the SD card with one of the prebuilt .wic image in production <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#PetaLinux-Board-Support-Packages">SOM BSP</a> to boot to Linux. This requires production SOM wic image so that Linux has eMMC awareness. Once downloaded, extract the bsp file and unzip the wic image in prebuilt folder to program SD card:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-&lt;board&gt;-&lt;version&gt;.bsp
l xilinx-&lt;board&gt;-&lt;version&gt;/pre-built/linux/images/petalinux-sdimage.wic.xz
</pre></div>
</div>
<p>If doing this for the second time (eMMC already have a good working Linux image), Kria SOM will choose to boot to eMMC prior to try to boot to SD. In order to boot to SD instead of eMMC, press “enter” when u-boot prompts to stop autoboot. In u-boot, use these commands to boot to PetaLinux image in sd:</p>
<p>[note: need to check if this is working]</p>
<p>For KV260, SD is mapped to mmc1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setenv</span> <span class="n">boot_targets</span> <span class="n">mmc1</span>
<span class="n">run</span> <span class="n">bootcmd_mmc1</span>
</pre></div>
</div>
<p>For KR260, SD is behind the USB hub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setenv</span> <span class="n">boot_targets</span> <span class="n">usb0</span>
<span class="n">run</span> <span class="n">bootcmd_usb0</span>
</pre></div>
</div>
</div>
<div class="section" id="write-to-emmc-in-linux">
<h4>Write to eMMC in Linux<a class="headerlink" href="#write-to-emmc-in-linux" title="Permalink to this heading">¶</a></h4>
<p>Once booted to Linux, you should be able to see  /dev/mmcblk0 -  the eMMC partition. Note on KV260 starter kit, there is also /dev/mmcblk1 - the SD partition. To double check, you can use this command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat /sys/class/mmc_host/mmc0/*/uevent
cat /sys/class/mmc_host/mmc1/*/uevent
</pre></div>
</div>
<p>if <code class="docutils literal notranslate"><span class="pre">MMC_TYPE=MMC</span></code>, it is an eMMC device, if <code class="docutils literal notranslate"><span class="pre">MMC_TYPE=SD</span></code>, it is a SD device.</p>
<p>Next, delete the partitions on eMMC.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>fdisk /dev/mmcblk0 <span class="c1">#delete all partitions using &quot;d&quot; + &quot;enter&quot; followed by &quot;partition number to be deleted&quot;</span>
</pre></div>
</div>
<p>Next, transfer the file over using your favorite method (such as scp, nfs, copying over SD card etc…). We are showing nfsroot method below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>On host computer:

```shell
nfsroot3 &lt;path to be mounted where wic image is present&gt;
```

On target:

```shell
mkdir /nfsroot
mount -t nfs -o nolock,proto=tcp,port=2049 10.10.70.101:/exports/root /nfsroot
#Use DD command to flash wic
dd if=/nfsroot/petalinux-sdimage.wic of=/dev/mmcblk0
```
</pre></div>
</div>
<p>Instead of nfxroot method, you can also use scp:</p>
<p>on host computer:</p>
<p>[note to self: add thre above after testing. also how do i program ubuntu instead of a wic image?]</p>
</div>
</div>
<div class="section" id="reboot-in-qspi-mode">
<h3>3. reboot in QSPI mode<a class="headerlink" href="#reboot-in-qspi-mode" title="Permalink to this heading">¶</a></h3>
<p>Next, boot the board in QSPI - simply power cycle or do following in xsdb to boot in QSPI again:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>targets -set -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ <span class="s2">&quot;PSU&quot;</span><span class="o">}</span>
mwr -force 0xffca0010 0x0<span class="p">;</span>mwr -force 0xff5e0200 0x2100
rst -system
targets -set -nocase -filter <span class="o">{</span><span class="nv">name</span> <span class="o">=</span>~ cortex-A53*0<span class="o">}</span>
con
</pre></div>
</div>
<p>refer to <a class="reference internal" href="bootfw_uboot_handoff.html"><span class="doc">u-boot handoff</span></a> “Prioritized Boot Order” section, on 22.1 or later, u-boot will prioritize handling off from QSPI to eMMC on production SOM, if images are available.</p>
</div>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h2>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center">Copyright&copy; 2021 Xilinx</p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on February 3, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>