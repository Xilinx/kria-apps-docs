<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Boot Firmware Overview &mdash; Boot SOM Firmware 2022.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Image Selector" href="bootfw_image_selector.html" />
    <link rel="prev" title="Boot Firmware" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> Boot SOM Firmware
            <img src="../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/Kria_doc_map/map.htm">Kria Adventure Map</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ipmi_eeprom.html">IPMI EEPROM Design Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Boot Firmware</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Boot Firmware Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#primary-boot-device">Primary Boot Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="#secondary-boot-device">Secondary Boot Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-b-boot-concept">A/B Boot Concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boot-fw-qspi-memory-map">Boot FW QSPI Memory Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-selector-registers">Image Selector Registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#persistent-register">Persistent Register</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boot-image-applications">Boot Image Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#image-selector-application">Image Selector Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-update">Image Update</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-recovery-application">Image Recovery Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#u-boot">U-Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#qspi-component-and-qspi-update">QSPI Component and QSPI Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_image_selector.html">Image Selector</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_image_recovery.html">Boot Image Recovery Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_pmu_config_obj.html">PMU Overlay Config Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_uboot_handoff.html">U-Boot Handoff</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_boot.bin_generation.html">Generating <code class="docutils literal notranslate"><span class="pre">BOOT.bin</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_qspi_stitching.html">Stitching QSPI Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_qspi_emmc_boot.html">QSPI to eMMC boot for Production SOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootfw_qspi_pxetftp_boot.html">QSPI to PXE/tftp boot</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Boot SOM Firmware</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Boot Firmware Overview</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/bootfw_overview.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="boot-firmware-overview">
<h1>Boot Firmware Overview<a class="headerlink" href="#boot-firmware-overview" title="Permalink to this heading">Â¶</a></h1>
<p>The SOM Starter Kits use a two stage boot process. The primary boot firmware is pre-installed at the factory on the QSPI device. The secondary boot device is an SD card containing the Linux kernel and Linux root filesystem (rootfs). The AMD Starter Kit carrier card hardware design sets the MPSoC boot mode to QSPI32. The SOM boots up to U-Boot using the QSPI contents and U-Boot then hand-off to the secondary boot device.</p>
<p>This document gives an overview to various components in the Kria SOM boot firmware, and points to source code available for customers to get started with their implementations for their Kria SOM  custom carrier card. For general information about boot of the Zynq MPSoC, refer to Zynq UltraScale TRM <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1085-zynq-ultrascale-trm/Boot-and-Configuration">Boot and Configuration</a> chapter.</p>
<p>The QSPI image and its boot firmware (FW) contents in SOM Starter Kits are common across all K26 starter kits.</p>
<p>The overall boot device definition and firmware contents are outlined in the following figure.</p>
<p><img alt="image" src="../_images/boot_location.png" /></p>
<p>For advanced evaluation a user can customize boot firmware using Yocto or the corresponding kit PetaLinux BSP. Refer to <a class="reference internal" href="bootfw_boot.bin_generation.html"><span class="doc">BootFW BOOT.BIN Generation page</span></a> for pointers on how to generate BOOT.BIN. Yocto or PetaLinux BSP can be used to generate a new BOOT.BIN that is then loaded to the QSPI user A/B partition and custom SD card contents summarized in the following diagram:</p>
<p><img alt="image" src="../_images/bsp_products.png" /></p>
<div class="section" id="primary-boot-device">
<h2>Primary Boot Device<a class="headerlink" href="#primary-boot-device" title="Permalink to this heading">Â¶</a></h2>
<p>The primary boot device is a QSPI device physically located on the Kria SOM. The necessary elements are packaged in a ZynqÂ® UltraScale+â¢ MPSoC specific format and file captured as BOOT.BIN. The BOOT.BIN file contains the board-specific boot firmware that consists of the following elements:</p>
<ul class="simple">
<li><p>FSBL: First-stage boot-loader firmware</p>
<ul>
<li><p><a class="reference external" href="https://github.com/Xilinx/embeddedsw/tree/master/lib/sw_apps/zynqmp_fsbl">Source code</a></p></li>
<li><p>FSBL is generated in <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto</a> or <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1144-petalinux-tools-reference-guide/First-Stage-Boot-Loader-for-Zynq-UltraScale-and-Zynq-7000-Devices">PetaLinux</a>, the flow is not unique to Kria SOM. Released SOM BSP generates FSBL by default when executing <code class="docutils literal notranslate"><span class="pre">petalinux-build</span></code>.</p></li>
</ul>
</li>
<li><p>PMU: Platform management unit firmware</p>
<ul>
<li><p><a class="reference external" href="https://github.com/Xilinx/embeddedsw/tree/master/lib/sw_apps/zynqmp_pmufw">Source code</a></p></li>
<li><p>SOM specific PMU guidance can be found on <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#MPSoC-PMU-FW">SOM wiki page</a></p></li>
</ul>
</li>
<li><p>TF-A: Trusted Firmware with support for A-Profile Arm processors</p>
<ul>
<li><p><a class="reference external" href="https://www.trustedfirmware.org/about/">Details</a></p></li>
<li><p><a class="reference external" href="https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/">Source code</a> and <a class="reference external" href="https://github.com/ARM-software/arm-trusted-firmware">read-only copy</a> - bl31 used</p></li>
</ul>
</li>
<li><p>U-Boot: Second-stage boot loader</p>
<ul>
<li><p><a class="reference external" href="#u-boot">details</a></p></li>
</ul>
</li>
</ul>
<p>The primary boot device provides a fail-over copy of boot firmware arranged in an A/B configuration. The A/B configuration provides a dynamic primary and secondary (last known working) image operation with corresponding update mechanisms. On boot, the system automatically boots from the defined primary image, and, if boot fails, it falls back to the previously known good boot image.</p>
</div>
<div class="section" id="secondary-boot-device">
<h2>Secondary Boot Device<a class="headerlink" href="#secondary-boot-device" title="Permalink to this heading">Â¶</a></h2>
<p>The secondary boot device on the Kria Starter Kits is an SD card. It contains the operating system image and associated application files. It also contains a superset of device trees for various board configurations and a boot script used by U-Boot to select the dynamically detected board configuration.</p>
</div>
<div class="section" id="a-b-boot-concept">
<h2>A/B Boot Concept<a class="headerlink" href="#a-b-boot-concept" title="Permalink to this heading">Â¶</a></h2>
<p>The Kria Starter Kits support an A/B FW update mechanism to ensure that the platform has a known good fallback in the event of an issue during the upgrade process. The A/B concept is that two copies of the software stack are maintained in the non-volatile (NV) memory, with one being the âcurrentâ image  and the other being âbackupâ.</p>
<p>For illustration, say the user booted till Linux using Image A.</p>
<p>The user has the capability to update the backup image, which is Image B in this case. This update can be done using bootfw_update utility from xmutils from Linux (also called <a class="reference external" href="#image-update">Image Update</a>). Upon updating Image B, the requested image is set to Image B and it is marked as âNon-Bootableâ.  Upon reboot, <a class="reference external" href="#image-selector-application">Image Selector</a> uses the following algorithm to decide which image to boot:</p>
<ol class="simple">
<li><p>If both images are marked âBootableâ, Image Selector boots the requested image.</p></li>
<li><p>If both images are marked âNon Bootableâ, this state implies the FW is in a bad state, since neither of the images are verified as booting till Linux and the system will then boot the <a class="reference external" href="#image-selector-application">Image Selector</a> application <a class="reference external" href="#image-recovery-application">Image Recovery</a>.  Note that this state should not occur if using then normal A/B update mechanisms.</p></li>
<li><p>If the requested image is non-bootable and the last booted image is bootable, it implies the requested image was updated during the previous boot and hence that image, Image B in the example, is selected for boot.</p></li>
<li><p>If the requested image is non-bootable and the last booted is non-bootable, it implies the newly updated Image B failed to boot. In this case, Image selector falls back to the known good image, which is Image A and Image A boots.</p></li>
</ol>
<p>ImgSel flow based on the QSPI persistent registers is shown in below figure.</p>
<p><img alt="image" src="../_images/imgsel.png" /></p>
<p>Kria SOM A/B updates builds on top of the MPSoC multi-boot functionality and abstracts the A/B concept with two pre-defined boot partitions. The boot.bin A/B partitions are maintained and laid out in the QSPI primary boot device. The QSPI will have a dedicated region for maintaining persistent boot state registers and the associated boot image offsets.</p>
<p>To work within the functionality of the MPSoC CSU ROM the Image Selector application that is launched at power-on reset (POR) to select which boot.bin image is used by passing a different offset to the CSU multi-boot register. The ImgSel application can be copied after each of the boot image partitions at the a 32KB boundary such that if the boot fails, CSU ROM functionality immediately loads ImgSel as the next discovered image. This allows ImgSel to provide the failure recovery mechanism to point back to the last bootable image based on the state information in the A/B Persistent Register.</p>
<p>Note that to see which image was selected for booting, read MultiBootOffset value from FSBL prints, for an example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  Zynq MP First Stage Boot Loader 
  Release 2023.1   May  1 2023  -  00:38:12
  MultiBootOffset: 0x40
  Reset Mode    :    System Reset
</pre></div>
</div>
<p>If MultiBootOffset is 0x40, image A was selected. If MultiBootOffset is 0x1f0, then image B was selected.</p>
</div>
<div class="section" id="boot-fw-qspi-memory-map">
<h2>Boot FW QSPI Memory Map<a class="headerlink" href="#boot-fw-qspi-memory-map" title="Permalink to this heading">Â¶</a></h2>
<p>The boot FW of the Kria Starter Kits is pre-loaded at time of production in the SOM QSPI memory. This device is intentionally isolated from the SD card to ensure that the board is always in a bootable state and SW developers can primarily focus on OS level updates and late bound loading of bitstreams. Sectors of the QSPI device on Kria Starter Kits are locked during production to prevent accidental overwrite in customer systems; with the only sectors that are read/write are the A and B boot partitions by the xmutil <a class="reference external" href="#image-update">Image Update</a> and <a class="reference external" href="#image-recovery-application">Image Recovery tools</a>.</p>
<p>Note that production SOM (that is to be used with custom CC) does not have locked or pre-loaded QSPI.</p>
<p>The following is QSPI memory map used for Kira SOM starter kits.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Offset (hex)</th>
<th>Size (hex)</th>
<th>Sector Access</th>
<th>Description</th>
<th>Linux mtd</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000000</td>
<td>0x80000</td>
<td>R</td>
<td><a href="#image-selector-application">Image Selector Application</a></td>
<td>0</td>
</tr>
<tr>
<td>0x00080000</td>
<td>0x80000</td>
<td>R</td>
<td>Image Selector Application Golden</td>
<td>1</td>
</tr>
<tr>
<td>0x00100000</td>
<td>0x20000</td>
<td>R/W</td>
<td><a href="#image-selector-registers">Image Selector registers</a></td>
<td>2</td>
</tr>
<tr>
<td>0x00120000</td>
<td>0x20000</td>
<td>R/W</td>
<td>Image Selector register backup</td>
<td>3</td>
</tr>
<tr>
<td>0x00140000</td>
<td>0xC0000</td>
<td>-</td>
<td>Reserved</td>
<td>4</td>
</tr>
<tr>
<td>0x00200000</td>
<td>0x300000</td>
<td>R/W</td>
<td>Image A ( BOOT.BIN containing FSBL, PMU, ATF, <a href="#u-boot">U-Boot</a>)</td>
<td>5</td>
</tr>
<tr>
<td>0x00500000</td>
<td>0xA00000</td>
<td>R/W</td>
<td>Space for larger images (PL - 8MB, RPU - 2MB)</td>
<td>5</td>
</tr>
<tr>
<td>0x00F00000</td>
<td>0x80000</td>
<td>R</td>
<td>ImgSel Image A Catch (ImgSel application)</td>
<td>6</td>
</tr>
<tr>
<td>0x00F80000</td>
<td>0x300000</td>
<td>R/W</td>
<td>Image B ( BOOT.BIN containing FSBL, PMU, ATF, <a href="#u-boot">U-Boot</a>)</td>
<td>7</td>
</tr>
<tr>
<td>0x01280000</td>
<td>0xA00000</td>
<td>R/W</td>
<td>Space for larger images (PL - 8MB, RPU - 2MB)</td>
<td>7</td>
</tr>
<tr>
<td>0x01C80000</td>
<td>0x80000</td>
<td>R</td>
<td>ImgSel Image B Catch (ImgSel application)</td>
<td>8</td>
</tr>
<tr>
<td>0x01D00000</td>
<td>0x100000</td>
<td>-</td>
<td>reserved</td>
<td>9</td>
</tr>
<tr>
<td>0x01E00000</td>
<td>0x200000</td>
<td>R</td>
<td><a href="#image-recovery-application">Image Recovery Application</a></td>
<td>10</td>
</tr>
<tr>
<td>0x02000000</td>
<td>0x200000</td>
<td>R</td>
<td>Image Recovery Application backup</td>
<td>11</td>
</tr>
<tr>
<td>0x02200000</td>
<td>0x20000</td>
<td>R/W</td>
<td>U-Boot storage variables</td>
<td>12</td>
</tr>
<tr>
<td>0x02220000</td>
<td>0x20000</td>
<td>R/W</td>
<td>U-Boot storage variables backup</td>
<td>13</td>
</tr>
<tr>
<td>0x02240000</td>
<td>0x40000</td>
<td>R</td>
<td>QSPI Image Version Information*</td>
<td>14</td>
</tr>
<tr>
<td>0x02280000</td>
<td>0x20000</td>
<td>R/W</td>
<td>Secure OS storage</td>
<td>15</td>
</tr>
<tr>
<td>0x022A0000</td>
<td>0x1d60000</td>
<td>R/W</td>
<td>End Address (User)</td>
<td>16</td>
</tr>
</tbody>
</table><p>*   QSPI Image Version Information Example: XilinxSom_QspiImage_v1.0_20201030 Last 32Bytes: HashValue Hash Algo: SHA256 It is only 256Bytes but has to be 64KB aligned - therefore size is 0x10000.</p>
<p>Starting from 2022.2, Yocto can generate QSPI images for Starter Kits. Information can be found in <a class="reference internal" href="bootfw_qspi_stitching.html"><span class="doc">QSPI Stitching page</span></a></p>
</div>
<div class="section" id="image-selector-registers">
<h2>Image Selector Registers<a class="headerlink" href="#image-selector-registers" title="Permalink to this heading">Â¶</a></h2>
<p>Below table shows contents of image selector registers at offset 0x100000</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Offset</th>
<th>Register</th>
<th>Description</th>
<th>Default Value for SOM Manufacturing Image</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0</td>
<td>Identification String</td>
<td>âABUMâ â A/B Update Mechanism</td>
<td>0x4D554241</td>
</tr>
<tr>
<td>0x4</td>
<td>Version</td>
<td>0x1</td>
<td>0x00000001</td>
</tr>
<tr>
<td>0x8</td>
<td>Length</td>
<td>4 â No of registers present (not including the first 4)</td>
<td>0x00000004</td>
</tr>
<tr>
<td>0xC</td>
<td>Checksum</td>
<td>SUM of all words excluding checksum</td>
<td>0xAEB1BDB9</td>
</tr>
<tr>
<td>0x10</td>
<td>Persistent State register</td>
<td>See <a href="#persistent-register">table below</a></td>
<td>0x01010000</td>
</tr>
<tr>
<td>0x14</td>
<td>Image A offset</td>
<td>CSU multi-boot address offset of "Image A". Must correspond to 32KB boundary.</td>
<td>0x00200000</td>
</tr>
<tr>
<td>0x18</td>
<td>Image B offset</td>
<td>CSU multi-boot address offset of "Image B". Must correspond to 32KB boundary</td>
<td>0x00F80000</td>
</tr>
<tr>
<td>0x1C</td>
<td>Recovery offset</td>
<td>CSU multi-boot address offset of "Recovery Image". Must correspond to 32KB boundary.</td>
<td>0x01E00000</td>
</tr>
</tbody>
</table></div>
<div class="section" id="persistent-register">
<h2>Persistent Register<a class="headerlink" href="#persistent-register" title="Permalink to this heading">Â¶</a></h2>
<p>Below table shows the encoding for persistent register. Default value for SOM manufacturing image: 0x01010000</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Bit width</th>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>7:0</td>
<td>Last Image Booted</td>
<td>R</td>
<td>0 - Image A, 1 - Image B</td>
</tr>
<tr>
<td>15:8</td>
<td>Requested Boot Image</td>
<td>RW</td>
<td>0 - Image A, 1 - Image B</td>
</tr>
<tr>
<td>23:16</td>
<td>Image B Bootable</td>
<td>RW</td>
<td>0 - Not bootable, 1 - Bootable</td>
</tr>
<tr>
<td>31:24</td>
<td>Image A Bootable</td>
<td>RW</td>
<td>0 - Not bootable, 1 - Bootable</td>
</tr>
</tbody>
</table></div>
<div class="section" id="boot-image-applications">
<h2>Boot Image Applications<a class="headerlink" href="#boot-image-applications" title="Permalink to this heading">Â¶</a></h2>
<p>The following applications uses or update Image A/B and/or persistent registers. All three applications are independent and can work standalone with no dependencies across the three applications.
For more information on how to uses the three applications, please refer to <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#Boot-Firmware-Updates">Kria SOM wiki</a> and <a class="reference external" href="https://www.xilinx.com/support/documentation/user_guides/som/1_0/ug1089-kv260-starter-kit.pdf">UG1089âs Board Reset, Firmware Update and Recovery chapter</a>.</p>
<div class="section" id="image-selector-application">
<h3>Image Selector Application<a class="headerlink" href="#image-selector-application" title="Permalink to this heading">Â¶</a></h3>
<p>The Image Selector(ImgSel) application is a small baremetal application running out of OCM after a POR/SRST to select the OS boot image. It reads the persistent register to decide which image to boot from in the QSPI memory map.</p>
<p>Read the <a class="reference internal" href="bootfw_image_selector.html"><span class="doc">Image Selector</span></a> page for more details on this application.</p>
</div>
<div class="section" id="image-update">
<h3>Image Update<a class="headerlink" href="#image-update" title="Permalink to this heading">Â¶</a></h3>
<p>The Image Update Linux application is a function being called by xmutil that updates image A or image B at run time. It is included in the Kria Starter Kit Linux root file system. When it is called to update image A or image B, it will also update the persistent register.</p>
<p>Read <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#Boot-FW-via-xmutil">Boot FW via xmutil section of Kria SOM wiki</a> for information on how to use Image Update. Visit the <a class="reference external" href="https://github.com/Xilinx/linux-image_update/tree/master">linux image update repository</a> to see its source code.</p>
</div>
<div class="section" id="image-recovery-application">
<h3>Image Recovery Application<a class="headerlink" href="#image-recovery-application" title="Permalink to this heading">Â¶</a></h3>
<p>The Image Recovery application is a baremetal application that uses a web-browser-based user interface. It is invoked when the FW-update button is pressed at power-on, or when both image A and image B becomes un-bootable. It can be used to directly update the A/B images and persistent register states.</p>
<p>Read the <a class="reference internal" href="bootfw_image_recovery.html"><span class="doc">Image Recovery</span></a> page for more details on this application.</p>
</div>
</div>
<div class="section" id="u-boot">
<h2>U-Boot<a class="headerlink" href="#u-boot" title="Permalink to this heading">Â¶</a></h2>
<p>U-Boot provides the functionality for the hand-off between the primary boot device and the secondary boot device. It will select the appropriate boot devices, load the Linux kernel, select Linux device tree based on detected HW configuration, and then boot Linux.</p>
<p>U-Boot is an open source Universal Boot Loader that is frequently used in the Linux community. AMD provides a Git tree located at <a class="reference external" href="https://github.com/Xilinx/u-boot-xlnx">github</a> which includes <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842223/U-boot">U-Boot to run on Xilinx boards</a>. U-Boot for SOM has been configured to support dynamic booting on different starter kits using MPSoC PMU configuration objects.</p>
<p>Read the <a class="reference internal" href="bootfw_pmu_config_obj.html"><span class="doc">PMU configuration objects</span></a> and <a class="reference internal" href="bootfw_uboot_handoff.html"><span class="doc">U-Boot handoff</span></a> for more details on dynamic carrier card configuration in Kria StarterKits.</p>
</div>
<div class="section" id="qspi-component-and-qspi-update">
<h2>QSPI Component and QSPI Update<a class="headerlink" href="#qspi-component-and-qspi-update" title="Permalink to this heading">Â¶</a></h2>
<p>QSPI used in commercial grade SOM is <a class="reference external" href="https://www.micron.com/products/nor-flash/serial-nor-flash/part-catalog/mt25qu512abb8e12-0sit">MT25QU512ABB8E12-0SIT</a>, QSPI used in I-grade SOM is <a class="reference external" href="https://www.micron.com/products/nor-flash/serial-nor-flash/part-catalog/mt25qu512abb8e12-0aat">MT25QU512ABB8E12-0AAT</a>. The QSPI has locking functionality - refer to linked datasheets on Micron for details.</p>
<p>If developers are developing on AMD released starter kits, QSPI image is locked and the only section that should need update is the Image A/B section along with the persistent registers.</p>
<p>However, if developers are developing their own carrier cards, the production SOMâs QSPI section is not locked. The entire QSPI can be customized by customers to meet their boot firmware requirements for their production designs.</p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading">Â¶</a></h2>
<p>Licensed under the Apache License, Version 2.0 (the âLicenseâ); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an âAS ISâ BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p class="sphinxhide" align="center">Copyright&copy; 2023 Advanced Micro Devices, Inc</p></div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Boot Firmware" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bootfw_image_selector.html" class="btn btn-neutral float-right" title="Image Selector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on February 01, 2024.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>