


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Kria™ KV260
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/index.html">SOM</a></li>
</ul>
<p class="caption"><span class="caption-text">Smart Camera</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="smartcamera/smartcamera_landing.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="smartcamera/smartcamera_landing.html#quick-start">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="smartcamera/smartcamera_landing.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="smartcamera/smartcamera_landing.html#architecture-documents">Architecture Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="smartcamera/smartcamera_landing.html#other">Other</a></li>
</ul>
<p class="caption"><span class="caption-text">AIBox-ReID</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="aibox-reid/aibox_landing.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="aibox-reid/aibox_landing.html#quick-start">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="aibox-reid/aibox_landing.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="aibox-reid/aibox_landing.html#architecture-documents">Architecture Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="aibox-reid/aibox_landing.html#other">Other</a></li>
</ul>
<p class="caption"><span class="caption-text">Defect Detection</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="defect-detect/defectdetect_landing.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="defect-detect/defectdetect_landing.html#quick-start">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="defect-detect/defectdetect_landing.html#tutorial">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="defect-detect/defectdetect_landing.html#architecture-documents">Architecture Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="defect-detect/defectdetect_landing.html#xilinx-support">Xilinx Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="defect-detect/defectdetect_landing.html#license">License</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../_sources/docs/build_petalinux.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Kria™ KV260</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/docs/build_petalinux.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="media/xilinx-logo.png" width="30%"/><h1>AA1: Kria&trade; KV260 Vision AI Starter Kit Tutorial</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h1>Building Petalinux</h1> </td>
 </tr>
</table><div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>This tutorial walks through the typical steps of creating and customizing a
bootable Linux image for the K26 SOM and the KV260 Vision AI Starter Kit. The Linux
starter image is headless without a Desktop environment. It comes pre-installed
with a minimal set of command line utilites and the jupyter lab IDE which you
can connect to from a web browser. Additional software packages and reference
design applications can be downloaded and installed from a package feed.</p>
<p>In the follwing sections, you will:</p>
<ol class="simple">
<li><p>Build the BSP with the default starter rootfs configuration.</p></li>
<li><p>Add the Xilinx application packagegroups into the project and configure it
for the KV260 AI starter kit.</p></li>
<li><p>Learn how to add your own Vivado or Vitis generated bitstream/xclbin firmware
components.</p></li>
</ol>
</div>
<div class="section" id="prerequisites">
<h1>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>PetaLinux 2020.2.2 tools installation</p></li>
<li><p>Petalinux SOM StarterKit BSP: xilinx-k26-starterkit-2020.2.2-final.bsp</p>
<ul class="simple">
<li><p>Download the SOM Starter Kit BSP from the <a class="reference external" href="https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-design-tools.html">Petalinux Download page</a></p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="create-the-project">
<h1>Create the Project<a class="headerlink" href="#create-the-project" title="Permalink to this headline">¶</a></h1>
<p>Run the following command to create a new Petalinux project from the provided
K26 SOM bsp file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ petalinux-create -t project -s xilinx-k26-starterkit-2020.2.2-final.bsp
$ cd xilinx-k26-starterkit-2020.2.2
</pre></div>
</div>
</div>
<div class="section" id="build-the-image">
<h1>Build the Image<a class="headerlink" href="#build-the-image" title="Permalink to this headline">¶</a></h1>
<p>Run the below commands to build and package the wic image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ petalinux-build
$ petalinux-package --wic --bootfiles &quot;ramdisk.cpio.gz.u-boot boot.scr Image system.dtb&quot;
</pre></div>
</div>
<p>The generated image file will be located at
<code class="docutils literal notranslate"><span class="pre">images/linux/petalinux-sdimage.wic</span></code>.</p>
<p><strong>Tip:</strong> The generated wic file assumes a fixed partition size. The total file
size is 4.1GB but the actual usage on the ext4 partition is much lower.
The file size can be significantly lower by compressing the file e.g.
using gzip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gzip images/linux/petalinux-sdimage.wic
</pre></div>
</div>
<p>This generates a new output file named
<code class="docutils literal notranslate"><span class="pre">images/linux/petalinux-sdimage.wic.gz</span></code> with a file size of 265M.</p>
<p>Flash the image on an SD card using Balena Etcher. This image is functionally
equivalent to the prebuilt wic image inside the bsp.</p>
</div>
<div class="section" id="build-the-sdk">
<h1>Build the SDK<a class="headerlink" href="#build-the-sdk" title="Permalink to this headline">¶</a></h1>
<p>A cross-compilation SDK is useful for application development on a host machine
for a specific target architecture e.g. X86 host and ARM 64-bit target. Run the
below command to generate a cross-compilation that can be used outside the
PetaLinux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ petalinux-build -s
</pre></div>
</div>
<p>The resulting self-extracting shell script installer file is located at
<code class="docutils literal notranslate"><span class="pre">images/linux/sdk.sh</span></code>.</p>
<p>The SDK installer script can be copied to the application developer’s host
machine and installed by simply running the script. Follow the prompts on the
screen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ images/linux/sdk.sh
PetaLinux SDK installer version 2020.2.2_SOM
============================================
Enter target directory for SDK (default: /opt/petalinux/2020.2.2_SOM): ./images/linux/sdk
You are about to install the SDK to &quot;/opt/petalinux/xilinx-k26-starterkit-2020.2.2/images/linux/sdk&quot;. Proceed [Y/n]? Y
</pre></div>
</div>
<p>Once the SDK is installed, source the file
<code class="docutils literal notranslate"><span class="pre">images/linux/sdk/environment-setup-aarch64-xilinx-linux</span></code>
to set up the cross-development environment.</p>
</div>
<div class="section" id="enable-xilinx-application-packages">
<h1>Enable Xilinx Application Packages<a class="headerlink" href="#enable-xilinx-application-packages" title="Permalink to this headline">¶</a></h1>
<p>The stock Petalinux BSP is configured for the K26 SOM but it is carrier card and
starter kit agnostic. To include KV260 starter kit specific packages on the
rootfs at build time, the <code class="docutils literal notranslate"><span class="pre">BOARD_VARIANT</span></code> variable needs to be set in the
config. Set the variable with the below command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;BOARD_VARIANT = &quot;kv&quot;&#39;</span> <span class="o">&gt;&gt;</span>  <span class="n">project</span><span class="o">-</span><span class="n">spec</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">petalinuxbsp</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>Verify that <code class="docutils literal notranslate"><span class="pre">BOARD</span></code> and <code class="docutils literal notranslate"><span class="pre">BOARD_VARIANT</span></code> are now set to the following values in
the file <code class="docutils literal notranslate"><span class="pre">petalinuxbsp.conf</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BOARD</span> <span class="o">=</span> <span class="s2">&quot;k26&quot;</span>
<span class="n">BOARD_VARIANT</span> <span class="o">=</span> <span class="s2">&quot;kv&quot;</span>
</pre></div>
</div>
<p>Both variables combined configure the bsp for the KV260 AI starter kit based on
the K26 SOM. It is now possible to enable packages with a package architecture
set to <code class="docutils literal notranslate"><span class="pre">k26_kv</span></code>.</p>
<p>Next, add the application packagegroups into the user rootfs config file such
that rootfs menuconfig gets populated with those entries.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s1">&#39;CONFIG_packagegroup-kv260-smartcam&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">project</span><span class="o">-</span><span class="n">spec</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">rootfsconfig</span>
<span class="n">echo</span> <span class="s1">&#39;CONFIG_packagegroup-kv260-aibox-reid&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">project</span><span class="o">-</span><span class="n">spec</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">rootfsconfig</span>
<span class="n">echo</span> <span class="s1">&#39;CONFIG_packagegroup-kv260-defect-detect&#39;</span> <span class="o">&gt;&gt;</span> <span class="n">project</span><span class="o">-</span><span class="n">spec</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">rootfsconfig</span>
</pre></div>
</div>
<p>Now run the petalinux rootfs config</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ petalinux-config -c rootfs
</pre></div>
</div>
<p>and select <code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">packages</span> <span class="pre">---&gt;</span></code> from the menu, then toggle on the newly added
application packagegroups by typing <code class="docutils literal notranslate"><span class="pre">y</span></code> next to those entries. The final
selection should look like this:</p>
<p><img alt="Petalinux rootfs config" src="../_images/plnx_rootfs_config.jpg" /></p>
<p>Then save and exit the configuration.</p>
<p>Continue with the build and image packaging instructions from above to build
a new image.</p>
</div>
<div class="section" id="add-new-fpga-firmware">
<h1>Add New FPGA Firmware<a class="headerlink" href="#add-new-fpga-firmware" title="Permalink to this headline">¶</a></h1>
<div class="section" id="create-firmware-recipe-for-custom-hardware">
<h2>Create firmware recipe for custom hardware<a class="headerlink" href="#create-firmware-recipe-for-custom-hardware" title="Permalink to this headline">¶</a></h2>
<p>After you have evaluated the Xilinx provided applications, you may want to
deploy your own custom hardware design. Petalinux provides a helper command to
create a new firmware recipe.</p>
</div>
<div class="section" id="fpgamanger-custom-bbclass">
<h2>fpgamanger_custom bbclass<a class="headerlink" href="#fpgamanger-custom-bbclass" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">fpgamanager_custom</span></code> bitbake class is a helper class to generate a set of
FPGA firmware binaries. The following hardware design hand-off artifacts are
required:</p>
<ol class="simple">
<li><p>PL bitstream - applies to Vivado or Vitis designs</p></li>
<li><p>Device tree overlay source file - the user needs to create this file based on
on the PL hardware design</p></li>
<li><p>Xclbin file - only applies to Vitis designs</p></li>
</ol>
<p>Run the following command to generate a new firmware recipe:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ petalinux-create -t apps --template fpgamanager -n user-firmware --enable --srcuri &quot;user.bit user.dtsi user.xclbin&quot;
</pre></div>
</div>
<p>The generated recipe will be located at
<code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-apps/user-firmware/user-firmware.bb</span></code> with the
following contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># This file is the user-firmware recipe.</span>
<span class="c1">#</span>

<span class="n">SUMMARY</span> <span class="o">=</span> <span class="s2">&quot;Simple user-firmware to use fpgamanager class&quot;</span>
<span class="n">SECTION</span> <span class="o">=</span> <span class="s2">&quot;PETALINUX/apps&quot;</span>
<span class="n">LICENSE</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
<span class="n">LIC_FILES_CHKSUM</span> <span class="o">=</span> <span class="s2">&quot;file://$</span><span class="si">{COMMON_LICENSE_DIR}</span><span class="s2">/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&quot;</span>

<span class="n">inherit</span> <span class="n">fpgamanager_custom</span>
<span class="n">FPGA_MNGR_RECONFIG_ENABLE</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<span class="n">SRC_URI</span> <span class="o">=</span> <span class="s2">&quot;file://user.bit </span><span class="se">\</span>
<span class="s2">           file://user.dtsi </span><span class="se">\</span>
<span class="s2">           file://user.xclbin </span><span class="se">\</span>
<span class="s2">           &quot;</span>

<span class="n">S</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{WORKDIR}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><strong>Important:</strong> For correct operation in the context of libdfx and dfx-mgrd, the
user needs to add the <code class="docutils literal notranslate"><span class="pre">fpga-config-from-dmabuf</span></code> dt property into
<code class="docutils literal notranslate"><span class="pre">fragment&#64;0</span></code> to be applied to the <code class="docutils literal notranslate"><span class="pre">fpga_full</span></code> target. See here
for an example snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fragment</span><span class="o">@</span><span class="mi">0</span> <span class="p">{</span>
	<span class="n">target</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">fpga_full</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="n">overlay0</span><span class="p">:</span> <span class="n">__overlay__</span> <span class="p">{</span>
		<span class="c1">#address-cells = &lt;2&gt;;</span>
		<span class="c1">#size-cells = &lt;2&gt;;</span>
		<span class="n">firmware</span><span class="o">-</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;kv260-aibox-reid.bit.bin&quot;</span><span class="p">;</span>
		<span class="n">fpga</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">dmabuf</span><span class="p">;</span>
		<span class="n">resets</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">zynqmp_reset</span> <span class="mi">116</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;&amp;</span><span class="n">zynqmp_reset</span> <span class="mi">117</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;&amp;</span><span class="n">zynqmp_reset</span> <span class="mi">118</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;&amp;</span><span class="n">zynqmp_reset</span> <span class="mi">119</span><span class="o">&gt;</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The recipe contains the minimum required elements but can be further customized
by the user for their needs.</p>
<p>Please refer to https://github.com/Xilinx/kv260-firmware for example dtsi files
based on the <code class="docutils literal notranslate"><span class="pre">fpgamanager_custom</span></code> class used in the Xilinx accelerated
applications.</p>
</div>
<div class="section" id="fpgamanger-dtg-bbclass">
<h2>fpgamanger_dtg bbclass<a class="headerlink" href="#fpgamanger-dtg-bbclass" title="Permalink to this headline">¶</a></h2>
<p>Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">fpgamanager_dtg</span></code> bitbake class which uses the
Xilinx device tree genrator (dtg) to generate a device tree overlay from a
Vivado or Vitis-generated XSA file. The following hardware design hand-off
artifacts are required:</p>
<ol class="simple">
<li><p>XSA file (must include bitstream) - applies to Vivado or Vitis designs</p></li>
<li><p>Device tree source file - the user can optionally add a device tree source
file that will be appended to the dtg-generated device tree file</p></li>
<li><p>Xclbin file - only applies to Vitis designs</p></li>
</ol>
<p>Run the following command to generate a new firmware recipe:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ petalinux-create -t apps --template fpgamanager -n user-firmware --enable --srcuri &quot;user.xsa user.dtsi user.xclbin&quot;
</pre></div>
</div>
<p>The generated recipe will be located at
<code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-apps/user-firmware/user-firmware.bb</span></code></p>
<p>In the recipe, change the following line from <code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">fpgamanager_custom</span></code>
to <code class="docutils literal notranslate"><span class="pre">inherit</span> <span class="pre">fpgamanager_dtg</span></code> as shown in the below example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># This file is the user-firmware recipe.</span>
<span class="c1">#</span>

<span class="n">SUMMARY</span> <span class="o">=</span> <span class="s2">&quot;Simple user-firmware to use fpgamanager class&quot;</span>
<span class="n">SECTION</span> <span class="o">=</span> <span class="s2">&quot;PETALINUX/apps&quot;</span>
<span class="n">LICENSE</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
<span class="n">LIC_FILES_CHKSUM</span> <span class="o">=</span> <span class="s2">&quot;file://$</span><span class="si">{COMMON_LICENSE_DIR}</span><span class="s2">/MIT;md5=0835ade698e0bcf8506ecda2f7b4f302&quot;</span>

<span class="n">inherit</span> <span class="n">fpgamanager_dtg</span>
<span class="n">FPGA_MNGR_RECONFIG_ENABLE</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<span class="n">SRC_URI</span> <span class="o">=</span> <span class="s2">&quot;file://user.xsa </span><span class="se">\</span>
<span class="s2">           file://user.dtsi </span><span class="se">\</span>
<span class="s2">           file://user.xclbin </span><span class="se">\</span>
<span class="s2">           &quot;</span>

<span class="n">S</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{WORKDIR}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>The recipe contains the minimum required elements but can be further customized
by the user for their needs.</p>
<p><strong>Important:</strong> For correct operation in the context of libdfx and dfx-mgrd, the
user needs to append the <code class="docutils literal notranslate"><span class="pre">fpga-config-from-dmabuf</span></code> dt property
to the <code class="docutils literal notranslate"><span class="pre">overlay0</span></code> node in a cutom <code class="docutils literal notranslate"><span class="pre">user.dtsi</span></code> file. See here for
an example <code class="docutils literal notranslate"><span class="pre">user.dtsi</span></code> snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">overlay0</span> <span class="p">{</span>
	<span class="n">fpga</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">dmabuf</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="firmware-installation-directory">
<h2>Firmware Installation Directory<a class="headerlink" href="#firmware-installation-directory" title="Permalink to this headline">¶</a></h2>
<p>Regardless of whether the <code class="docutils literal notranslate"><span class="pre">fpgamanger_custom</span></code> or <code class="docutils literal notranslate"><span class="pre">fpgamanger_dtg</span></code> bbclass is
used, the resulting output products are installed into the
<code class="docutils literal notranslate"><span class="pre">/lib/firmware/xilinx/user-firmware</span></code> directory on the target rootfs. The output
products are:</p>
<ol class="simple">
<li><p>Bitstream in bin format - this means the bitstream header is stripped</p></li>
<li><p>Device tree overlay binary (dtbo) compiled from the dtsi file(s)</p></li>
<li><p>Xclbin - this file is unchanged</p></li>
</ol>
<p>At run-time, the FPGA firmware can be loaded using the <code class="docutils literal notranslate"><span class="pre">xmutil</span> <span class="pre">loadapp</span></code> utility
which is explained in more detail in the getting started guide.</p>
</div>
</div>
<div class="section" id="next-step">
<h1>Next Step<a class="headerlink" href="#next-step" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Go back to the <a class="reference internal" href="../index.html"><span class="doc">KV260 SOM designs start page</span></a></p></li>
</ul>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Petalinux user guide <a class="reference external" href="https://www.xilinx.com/support/documentation/sw_manuals/xilinx2020_2/ug1144-petalinux-tools-reference-guide.pdf">UG1144</a></p></li>
</ul>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center">Copyright&copy; 2021 Xilinx</p></div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on April 13, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>