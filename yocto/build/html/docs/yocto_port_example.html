<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Porting an Application to PetaLinux - Smartcam &mdash; Yocto Support 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Library Dependency" href="library_dependency.html" />
    <link rel="prev" title="Yocto Kria Support" href="yocto_kria_support.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../index.html" class="icon icon-home"> Yocto Support
            <img src="../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">SOM</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/">Landing Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/creating_applications.html">Application Development</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ubuntu_support.html">Ubuntu Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/bootfw.html">Boot Firmware</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/openamp.html">OpenAMP</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/dfx.html">Dynamic Function eXchange</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/ipmi_eeprom.html">IPMI EEPROM Design Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/yocto.html">Yocto Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/xen.html">XEN Support</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kd240-docs.html">Kria KD240</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260-docs.html">Kria KV260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kr260-docs.html">Kria KR260</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/KRS/">Kria Robotics Stack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Yocto Support</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="yocto_kria_support.html">Yocto Kria Support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Porting an Application to PetaLinux - Smartcam</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#build-on-target">Build on Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-a-wic-image-or-rpm-packages">Building a WIC image or RPM packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-create-petalinux-project">Step 1: Create PetaLinux Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-add-recipe-for-smartcam-fpga-firmware">Step 2: Add Recipe for Smartcam FPGA firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-add-recipe-for-ap1302-firmware">Step 3: Add Recipe for AP1302 Firmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-add-recipe-for-smartcam-software">Step 4: Add Recipe for Smartcam Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-create-packagegroup">Step 5: Create Packagegroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-build">Step 6: Build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#option-1-baking-into-wic-image">Option 1 - baking into WIC image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-2-generate-rpm-and-install-on-released-wic-image">Option 2 - generate RPM and install on released wic image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#step-7-test">Step 7: Test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="library_dependency.html">Library Dependency</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Yocto Support</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Porting an Application to PetaLinux - Smartcam</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/docs/yocto_port_example.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="porting-an-application-to-petalinux-smartcam">
<h1>Porting an Application to PetaLinux - Smartcam<a class="headerlink" href="#porting-an-application-to-petalinux-smartcam" title="Permalink to this heading">Â¶</a></h1>
<p>This page documents a step by step example that ports Smartcam application to run on PetaLinux OS. Developers can use this as a guide to port their own applications onto PetaLinux. Note that starting from 2022.1 and newer, example applications are supported on Ubuntu and not PetaLinux, giving an opportunity to show porting process for one of the example applications.</p>
<p>The example here was tested using smartcam and tool version 2022.1. It assumes that you have already familiar with the smartcam application either using <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260/2022.1/build/html/docs/smartcamera/docs/app_deployment.html#">Ubuntu with tool version 2022.1</a> or <a class="reference external" href="https://xilinx.github.io/kria-apps-docs/kv260/2021.1/build/html/docs/smartcamera/docs/app_deployment.html">PetaLinux 2021.1</a>.</p>
<p>There are 3 ways to port smartcam onto PetaLinux OS:</p>
<p>Without having to use PetaLinux toolchain:</p>
<ul class="simple">
<li><p>Build on target</p></li>
</ul>
<p>Using PetaLinux toolchain, the following two methods has some overlap steps with eachother, therefore they are documented under the <a class="reference external" href="#building-a-wic-image-or-rpm-packages">same section</a>:</p>
<ul class="simple">
<li><p>Build a new PetaLinux wic image with smartcam baked in using recipes</p></li>
<li><p>Generate an RPM using PetaLinux and recipes, and move to target</p></li>
</ul>
<div class="section" id="build-on-target">
<h2>Build on Target<a class="headerlink" href="#build-on-target" title="Permalink to this heading">Â¶</a></h2>
<p>This section outlines how to build smartcam on KV260 target running released 2022.1 wic image. First, download and boot with <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#PetaLinux">2022.1 PetaLinux Starter Kit Linux pre-built SD card image</a>. Once booted, download git, and repositories required for building smartcam - the FPGA firmware, AP1302 firmware, and smartcam application software:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo dnf install -y git
git clone --branch xlnx-rel-v2022.1_update4 https://github.com/Xilinx/kria-apps-firmware.git
git clone --branch xlnx_rel_v2022.1 https://github.com/Xilinx/ap1302-firmware.git
git clone --branch xlnx_rel_v2022.1 https://github.com/Xilinx/smartcam.git
</pre></div>
</div>
<p>Next, copy the smartcam FPGA Firmware and AP1302 firmware to the correct location:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> kria-apps-firmware/boards/kv260/smartcam/
dtc -@ -O dtb -o kv260-smartcam.dtbo kv260-smartcam.dtsi <span class="c1"># generate binary for device tree from .dtsi - errors can be ignored</span>
<span class="nb">cd</span> /home/petalinux/
sudo cp kria-apps-firmware/boards/kv260/smartcam/ /lib/firmware/xilinx/kv260-smartcam -r
sudo cp ap1302-firmware/ap1302_ar1335_single_fw.bin /lib/firmware/
</pre></div>
</div>
<p>Next, install runtime and build dependencies. Note that 2022.1 smartcam is compatible only with specific versions of zcol and xrt. Therefore install them first with the compatible versions to prevent latest version to be installed when other dependencies are installed. (Tip: copy below section to a .sh file on target and source the .sh file to save time.)</p>
<p>Note that the example applications are verified with specific versions of XRT, VVAS and Vitis-AI libraries, which may not be backward compatible. So you will need to first install specific versions per instructions below. Find more information in <a class="reference internal" href="library_dependency.html"><span class="doc">library dependency</span></a> page.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># install specific versions of zocl, xrt, VVAS, and Vitis-AI:</span>
<span class="c1"># zocl needs to be installed before xrt - otherwise xrt will install latest zocl as dependency</span>
sudo dnf install -y zocl-202210.2.13.479
sudo dnf install -y xrt-202210.2.13.479
sudo dnf install -y vitis-ai-library-2.5
sudo dnf install -y vvas-accel-libs-2.0
sudo dnf install -y vitis-ai-library-dev-2.5
sudo dnf install -y vvas-accel-libs-dev-2.0

<span class="c1"># Install the rest of runtime dependencies</span>
sudo dnf install -y glog
sudo dnf install -y gstreamer1.0-rtsp-server
sudo dnf install -y opencv

<span class="c1"># Install the rest of build time dependencies</span>
sudo dnf install -y packagegroup-petalinux-self-hosted
sudo dnf install -y gst-perf-dev gstreamer1.0-omx-dev gstreamer1.0-python-dev
sudo dnf install -y gstreamer1.0-rtsp-server-dev v4l-utils-dev
sudo dnf install -y alsa-utils-dev opencv-dev
sudo dnf install -y gst-perf gstreamer1.0-omx gstreamer1.0-plugins-bad-faac
sudo dnf install -y gstreamer1.0-plugins-bad-mpegtsmux gstreamer1.0-plugins-good-rtp
sudo dnf install -y gstreamer1.0-plugins-bad-kms gstreamer1.0-plugins-bad-mediasrcbin
sudo dnf install -y gstreamer1.0-plugins-bad-videoparsersbad gstreamer1.0-plugins-good-multifile
sudo dnf install -y gstreamer1.0-plugins-good-rtpmanager gstreamer1.0-plugins-good-udp
sudo dnf install -y gstreamer1.0-plugins-good-video4linux2 gstreamer1.0-python
sudo dnf install -y libdrm-tests v4l-utils alsa-utils python3-core
</pre></div>
</div>
<p>Lastly, build the smartcam application:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># build smartcam</span>
<span class="nb">cd</span> smartcam
mkdir build
<span class="nb">cd</span> build
cmake -DCMAKE_INSTALL_PREFIX<span class="o">=</span>/ ../
make -j
sudo make install
<span class="c1"># smartcam binary will be available at  /opt/xilinx/kv260-smartcam/bin/smartcam</span>
</pre></div>
</div>
<p>Finally, test the smartcam on target:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo xmutil listapps                            <span class="c1"># kv260-smartcam should show up in the list</span>
sudo xmutil unloadapp                           <span class="c1"># unload existing firmware</span>
sudo xmutil loadapp kv260-smartcam              <span class="c1"># Load smartcam firmware</span>
sudo /opt/xilinx/kv260-smartcam/bin/smartcam -m
</pre></div>
</div>
</div>
<div class="section" id="building-a-wic-image-or-rpm-packages">
<h2>Building a WIC image or RPM packages<a class="headerlink" href="#building-a-wic-image-or-rpm-packages" title="Permalink to this heading">Â¶</a></h2>
<p>You need PetaLinux 2022.1 with eSDK update 3 or later, as vvas library is released asynchronously and not included in the main 2022.1 petalinux tools release. Download PetaLinux Tools Installer 2022.1 from <a class="reference external" href="https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-design-tools.html">PetaLinux Download page</a>.</p>
<p>To install PetaLinux, extract the petalinux installer, accept the license and source the toolâs settings script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-v2021.1-final-installer.run
<span class="nb">source</span> settings.sh
</pre></div>
</div>
<p>The eSDK can be used to update the petalinux tool for creating new images or SDKs. The eSDK updates are
published <a class="reference external" href="http://petalinux.xilinx.com/sswreleases/rel-v2022/sdkupdate/2022.1_update3/">here</a>
Upgrade the tool with new eSDK for â2022.1 update3â release and source the toolâs settings script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-upgrade -u <span class="s1">&#39;http://petalinux.xilinx.com/sswreleases/rel-v2022/sdkupdate/2022.1_update3/&#39;</span> -p <span class="s1">&#39;aarch64&#39;</span>
<span class="nb">source</span> settings.sh
</pre></div>
</div>
<p>The petalinux tool is now updated with â2022.1 update3â Yocto eSDK.</p>
<div class="section" id="step-1-create-petalinux-project">
<h3>Step 1: Create PetaLinux Project<a class="headerlink" href="#step-1-create-petalinux-project" title="Permalink to this heading">Â¶</a></h3>
<p>First, download the KV260 2022.1 BSP from <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM#PetaLinux-Board-Support-Packages">Kria SOM Wiki</a>. Using PetaLinux tool version 2022.1, create a project:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-create -t project -s xilinx-kv260-starterkit-v2022.1-&lt;timestamp&gt;.bsp
<span class="nb">cd</span> xilinx-kv260-starterkit-2022.1/
</pre></div>
</div>
<p>Note that we will be now adding 4 recipes for smartcam FPGA firmware, AP1302 firmware, smartcam software, and a packagegroup to bring them together. The recipes will be added to the <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user</span></code> folder, which is a meta-layer thats already included in the project, which you can confirm by looking at <code class="docutils literal notranslate"><span class="pre">build/conf/bblayers.conf</span></code> after a petalinux-build. If you choose to add the recipes to other meta-layer folders, be sure to <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1144-petalinux-tools-reference-guide/Adding-Layers">add the layer</a> first.</p>
</div>
<div class="section" id="step-2-add-recipe-for-smartcam-fpga-firmware">
<h3>Step 2: Add Recipe for Smartcam FPGA firmware<a class="headerlink" href="#step-2-add-recipe-for-smartcam-fpga-firmware" title="Permalink to this heading">Â¶</a></h3>
<p>FPGA Firmware for Smartcam 2022.1 is released on <a class="reference external" href="https://github.com/Xilinx/kria-apps-firmware/tree/xlnx-rel-v2022.1_update4/boards/kv260/smartcam">github</a>. It includes the bitstream, and its associated .xclbin, .dtsi and shell.json files. First make the folder example_firmware to keep the recipe file:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir -p project-spec/meta-user/recipes-firmware/example_firmware
</pre></div>
</div>
<p>Below is the content for <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-firmware/example_firmware/kv260-smartcam.bb</span></code>. Note the latest commit ID correspond to the tag xlnx-rel-v2022.1_update4 when creating the recipe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">SUMMARY</span> <span class="o">=</span> <span class="s2">&quot;Firmware for Example design&quot;</span>

<span class="n">LICENSE</span> <span class="o">=</span> <span class="s2">&quot;Proprietary &amp; GPL-2.0&quot;</span>
<span class="n">LIC_FILES_CHKSUM</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="se">\</span>
<span class="s2">Â  Â  Â  Â  file://$</span><span class="si">{WORKDIR}</span><span class="s2">/git/LICENSE-BINARIES;md5=fa9b03ada9ffccf51dd60899bf28c702 </span><span class="se">\</span>
<span class="s2">Â  Â  Â  Â  file://$</span><span class="si">{WORKDIR}</span><span class="s2">/git/LICENSE-GPLv2;md5=9afdcd1be3f71bd3791fa5961075d776 </span><span class="se">\</span>
<span class="s2">Â  Â  Â  Â  &quot;</span>

<span class="c1"># Specify the source of firmware</span>
<span class="n">BRANCH</span> <span class="o">=</span> <span class="s2">&quot;xlnx_rel_v2022.1&quot;</span>
<span class="n">SRC_URI</span> <span class="o">=</span> <span class="s2">&quot;git://github.com/Xilinx/kria-apps-firmware.git;protocol=https;branch=$</span><span class="si">{BRANCH}</span><span class="s2">&quot;</span>
<span class="c1"># the following specifies the commit ID of the version of repo to use</span>
<span class="n">SRCREV</span> <span class="o">=</span> <span class="s2">&quot;9d7d92d8a89f911ae8c1b0a25316c924c1a4ff3f&quot;</span> 


<span class="n">inherit</span> <span class="n">fpgamanager_custom</span>

<span class="n">PACKAGE_ARCH</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{MACHINE_ARCH}</span><span class="s2">&quot;</span>

<span class="n">FW_DIR</span> <span class="o">=</span> <span class="s2">&quot;boards/kv260/smartcam&quot;</span> <span class="c1">#specifies which folder of the repo to use</span>

<span class="n">COMPATIBLE_MACHINE</span><span class="p">:</span><span class="n">k26</span><span class="o">-</span><span class="n">kv</span> <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{MACHINE}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-add-recipe-for-ap1302-firmware">
<h3>Step 3: Add Recipe for AP1302 Firmware<a class="headerlink" href="#step-3-add-recipe-for-ap1302-firmware" title="Permalink to this heading">Â¶</a></h3>
<p>Smartcam uses AR1335 MIPI sensor, which requires AP1302 firmware. AP1302 is released on <a class="reference external" href="https://github.com/Xilinx/ap1302-firmware/tree/xlnx_rel_v2022.1">github</a>.  We will first create a folder called âap1302-firmwareâ to keep the AP1302 recipes <code class="docutils literal notranslate"><span class="pre">ap1302-firmware.inc</span></code> and <code class="docutils literal notranslate"><span class="pre">ap1302-ar1335-single-firmware.bb</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir -p project-spec/meta-user/recipes-firmware/ap1302-firmware/
</pre></div>
</div>
<p>Below is the content for <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-firmware/ap1302-firmware/ap1302-ar1335-single-firmware.bb</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SUMMARY</span> <span class="o">=</span> <span class="s2">&quot;ap1302 ar1335-single firmware binary&quot;</span>

<span class="n">include</span> <span class="n">ap1302</span><span class="o">-</span><span class="n">firmware</span><span class="o">.</span><span class="n">inc</span>

<span class="n">FW_NAME</span> <span class="o">=</span> <span class="s2">&quot;ap1302_ar1335_single_fw.bin&quot;</span>
</pre></div>
</div>
<p>Below is the content for <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-firmware/ap1302-firmware/ap1302-firmware.inc</span></code>, which the above recipe included:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>LICENSE = &quot;Proprietary&quot;
LIC_FILES_CHKSUM = &quot;file://LICENSE.txt;md5=9c13aad1aab42f76326f1beceafc40c4&quot;

BRANCH ?= &quot;xlnx_rel_v2022.1&quot;
SRC_URI = &quot;git://github.com/Xilinx/ap1302-firmware.git;protocol=https;branch=${BRANCH}&quot;
SRCREV ?= &quot;63e20752dc8b1e91fc6d6d518ebeb76f65e9f738&quot;

S = &quot;${WORKDIR}/git&quot;

FW_NAME ?= &quot;&quot;

do_configure[noexec] = &quot;1&quot;
do_compile[noexec] = &quot;1&quot;

do_install() {
	# create /lib/firmware
	install -d ${D}/lib/firmware
	# copy firmware binary to /lib/firmware
	install -m 0644 ${FW_NAME} ${D}/lib/firmware/${FW_NAME}
}

FILES:${PN} = &quot;/lib/firmware/${FW_NAME}&quot;
</pre></div>
</div>
</div>
<div class="section" id="step-4-add-recipe-for-smartcam-software">
<h3>Step 4: Add Recipe for Smartcam Software<a class="headerlink" href="#step-4-add-recipe-for-smartcam-software" title="Permalink to this heading">Â¶</a></h3>
<p>Next, we add the recipe for smartcam software, which is released at <a class="reference external" href="https://github.com/Xilinx/smartcam/tree/xlnx_rel_v2022.1">github</a> for 2022.1. We first create a folder for application recipe:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir -p project-spec/meta-user/recipes-apps/smartcam/
</pre></div>
</div>
<p>Then we create the following content in file <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-apps/smartcam/smartcam.bb</span></code>, Note the commit ID - move to the latest commit ID if needed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>SUMMARY = &quot;Example Smartcam application&quot;

LICENSE = &quot;Apache-2.0&quot;
LIC_FILES_CHKSUM = &quot;file://LICENSE;md5=a9c5ded2ac97b4ce01aa0ace8f3a1755&quot;

BRANCH = &quot;xlnx_rel_v2022.1&quot;
SRC_URI = &quot;git://github.com/Xilinx/smartcam.git;protocol=https;branch=${BRANCH}&quot;
SRCREV = &quot;ad9523ee5f002141334698eb6ddc9a14679ac8d2&quot;

inherit cmake

# DEPENDS specifies runtime dependencies
DEPENDS = &quot;vvas-accel-libs glog gstreamer1.0-rtsp-server opencv&quot;
#RDEPENDS specifies build-time dependencies
RDEPENDS:${PN} = &quot; \
Â  Â  gst-perf \
Â  Â  gstreamer1.0-omx \
Â  Â  gstreamer1.0-plugins-bad-faac \
Â  Â  gstreamer1.0-plugins-bad-mpegtsmux \
Â  Â  gstreamer1.0-plugins-good-rtp \
Â  Â  gstreamer1.0-plugins-bad-kms \
Â  Â  gstreamer1.0-plugins-bad-mediasrcbin \
Â  Â  gstreamer1.0-plugins-bad-videoparsersbad \
Â  Â  gstreamer1.0-plugins-good-multifile \
Â  Â  gstreamer1.0-plugins-good-rtpmanager \
Â  Â  gstreamer1.0-plugins-good-udp \
Â  Â  gstreamer1.0-plugins-good-video4linux2 \
Â  Â  gstreamer1.0-python \
Â  Â  gstreamer1.0-rtsp-server \
Â  Â  vvas-accel-libs \
Â  Â  libdrm-tests \
Â  Â  v4l-utils \
Â  Â  alsa-utils \
Â  Â  python3-core \
Â  Â  &quot;

SOMAPP_INSTALL_PATH = &quot;/&quot;
EXTRA_OECMAKE += &quot;-DCMAKE_BUILD_TYPE=Release -DCMAKE_SYSROOT=${STAGING_DIR_HOST} -DCMAKE_INSTALL_PREFIX=${SOMAPP_INSTALL_PATH} &quot;

S = &quot;${WORKDIR}/git&quot;

FILES:${PN} += &quot; \
Â  Â  /opt/xilinx \
Â  Â  &quot;
</pre></div>
</div>
</div>
<div class="section" id="step-5-create-packagegroup">
<h3>Step 5: Create Packagegroup<a class="headerlink" href="#step-5-create-packagegroup" title="Permalink to this heading">Â¶</a></h3>
<p>Next, we want to create the package group to include both the firmware and software, as well as the AR1335 driver that is needed for this application. <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1144-petalinux-tools-reference-guide/Adding-a-Package-Group">UG1144</a> also details this step.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir -p project-spec/meta-user/recipes-core/packagegroups/
</pre></div>
</div>
<p>Then create  <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/recipes-core/packagegroups/packagegroup-kv260-smartcam.bb</span></code> with the following content:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>DESCRIPTION = &quot;Example Smartcam related Packages&quot;

inherit packagegroup

EXAMPLE_PACKAGES = &quot; \
Â  Â  ap1302-ar1335-single-firmware \
Â  Â  kv260-smartcam \
Â  Â  smartcam \
Â  Â  &quot;

RDEPENDS:${PN} = &quot;${EXAMPLE_PACKAGES}&quot;

COMPATIBLE_MACHINE = &quot;^$&quot;
COMPATIBLE_MACHINE:k26-kv = &quot;${MACHINE}&quot;
PACKAGE_ARCH = &quot;${MACHINE_ARCH}&quot;
</pre></div>
</div>
<p>Add below line to <code class="docutils literal notranslate"><span class="pre">project-spec/meta-user/conf/user-rootfsconfig</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CONFIG_packagegroup-kv260-smartcam
</pre></div>
</div>
<p>Enable the package group by using below command to get to configuration gui:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-config -c rootfs
</pre></div>
</div>
<p>Go to <code class="docutils literal notranslate"><span class="pre">user</span> <span class="pre">packages</span></code> to enable packagegroup-kv260-smartcam</p>
</div>
<div class="section" id="step-6-build">
<h3>Step 6: Build<a class="headerlink" href="#step-6-build" title="Permalink to this heading">Â¶</a></h3>
<div class="section" id="option-1-baking-into-wic-image">
<h4>Option 1 - baking into WIC image<a class="headerlink" href="#option-1-baking-into-wic-image" title="Permalink to this heading">Â¶</a></h4>
<p>Now that all the meta layers are in place, build the image:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>petalinux-build
petalinux-package --wic --bootfiles <span class="s2">&quot;ramdisk.cpio.gz.u-boot boot.scr Image system.dtb&quot;</span>
</pre></div>
</div>
<p>Flash the generated image in ``images/linux/petalinux-sdimage.wic``` onto SD card and boot on a KV260.</p>
</div>
<div class="section" id="option-2-generate-rpm-and-install-on-released-wic-image">
<h4>Option 2 - generate RPM and install on released wic image<a class="headerlink" href="#option-2-generate-rpm-and-install-on-released-wic-image" title="Permalink to this heading">Â¶</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>petalinux-build -c smartcam
petalinux-build -c kv260-smartcam
petalinux-build -c ap1302-ar1335-single-firmware
</pre></div>
</div>
<p>resulting rmp can be found in:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">$TMP</span>/deploy/rpm/xilinx_k26_kv/kv260-smartcam-1.0-r0.0.xilinx_k26_kv.rpm
<span class="nv">$TMP</span>/deploy/rpm/cortexa72_cortexa53/smartcam-1.0-r0.0.cortexa72_cortexa53.rpm
<span class="nv">$TMP</span>/deploy/rpm/cortexa72_cortexa53/ap1302-ar1335-single-firmware-1.0-r0.0.cortexa72_cortexa53.rpm
</pre></div>
</div>
<p>$TMP location can be found at <code class="docutils literal notranslate"><span class="pre">project-spec/configs/config</span> <span class="pre">CONFIG_TMP_DIR_LOCATION=$TMP</span></code></p>
<p>Then move the .rpm files to target (that is booted in released 22.1 .wic image) and install using dnf, so they will install dependencies as well. However, note that for 2022.1 version of Smartcam, you need specific, compatible versions of zocl and xrt which is not the latest - therefore we need to first install the specific versions to prevent a later, incompatible version to be installed automatically.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo dnf install -y zocl-202210.2.13.479-r0.0 
sudo dnf install -y xrt-202210.2.13.479-r0.0
sudo dnf install -y kv260-smartcam-1.0-r0.0.xilinx_k26_kv.rpm
sudo dnf install -y smartcam-1.0-r0.0.cortexa72_cortexa53.rpm
sudo dnf install -y ap1302-ar1335-single-firmware-1.0-r0.0.cortexa72_cortexa53.rpm
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-7-test">
<h3>Step 7: Test<a class="headerlink" href="#step-7-test" title="Permalink to this heading">Â¶</a></h3>
<p>Test that firmware and applications have loaded correctly:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo xmutil listapps                            <span class="c1"># kv260-smartcam should show up in the list</span>
sudo xmutil unloadapp                           <span class="c1"># unload existing firmware</span>
sudo xmutil loadapp kv260-smartcam              <span class="c1"># Load smartcam firmware</span>
sudo /opt/xilinx/kv260-smartcam/bin/smartcam -m <span class="c1"># Execute smartcam application using a MIPI sensor</span>
</pre></div>
</div>
<p>You should see the application displaying image from MIPI sensor to the screen.</p>
</div>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading">Â¶</a></h2>
<p>Licensed under the Apache License, Version 2.0 (the âLicenseâ); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at
<a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an âAS ISâ BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p class="sphinxhide" align="center">Copyright&copy; 2023 Advanced Micro Devices, Inc</p></div>
</div>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="yocto_kria_support.html" class="btn btn-neutral float-left" title="Yocto Kria Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="library_dependency.html" class="btn btn-neutral float-right" title="Library Dependency" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on March 6, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>